{"version":3,"sources":["assets/gifs/ajax-loader--gray.gif","assets/icons/svgs/property.svg","assets/icons/svgs/text-document.svg","assets/gifs/ajax-loader--blue.gif","assets/icons/svgs/chevron-blue.svg","assets/images/tagging-tracker-logo.PNG","assets/icons/svgs/chevron.svg","assets/icons/svgs/upload.svg","assets/icons/svgs/switch.svg","assets/icons/svgs/add-square.svg","assets/icons/svgs/delete.svg","assets/icons/svgs/close.svg","components/edit-tags/EditTags.js","utils/date.js","components/navbar/Navbar.js","components/login/Login.js","components/addresses/Addresses.js","utils/image.js","components/view-address/ViewAddress.js","utils/tagFields.js","components/tag-info/TagInfo.js","components/owner-info/OwnerInfo.js","utils/sync/syncUp.js","utils/sync/syncDown.js","utils/sync/sync.js","utils/misc.js","utils/delete.js","components/bottom-navbar/BottomNavbar.js","pages/page404/Page404.js","components/add-tag/AddTag.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","fileNameOfImageToDelete","fileTimeStamp","getDateTime","format","process","TZ","date_ob","Date","date","getDate","slice","month","getMonth","year","getFullYear","hours","getHours","minutes","getMinutes","seconds","getSeconds","Navbar","props","searchAddressInput","useRef","useState","showSettings","setShowSettings","editSaveOwnerInfo","toggleModifyOwnerInfo","modifyOwnerInfo","editTagInfo","toggleModifyTagInfo","modifyTagInfo","toggleSettings","useEffect","showAddressModal","location","pathname","current","value","length","focus","checkOnlineStatus","className","routeLocation","path","baseDir","replace","onClick","toggleAddressModal","type","updateSoftware","searchedAddress","placeholder","ref","onChange","e","searchStr","target","searchAddress","to","state","clearSearch","address","addressId","src","backArrow","alt","addressOutput","substring","getBackButtonTitle","getNavTitle","isEditTagsPath","indexOf","isAddTagPath","generateEditBtn","renderNavbar","Login","usernameInput","passwordInput","loginBtn","history","useHistory","loginProcessing","setLoginProcessing","token","push","taggingTrackerLogo","name","postUrl","window","href","username","password","axios","post","then","res","data","updateToken","catch","err","alert","disabled","Addresses","newAddressInput","cancelAddAddressBtn","createAddressBtn","addAddressProcessing","setAddAddressProcessing","recentAddresses","activeAddresses","setActiveAddresses","checkAddressExists","addressStr","offlineStorage","open","addresses","toArray","where","equals","saveAddress","a","async","transaction","add","lat","lng","created","updated","insertedId","newRowId","concat","setShowAddressModal","clearSearchAddress","addressesFormatted","regex","RegExp","filter","test","map","id","tagInfo","tag","tagText","tags","searchAddresses","splice","index","key","rightArrow","getImagePreviewAspectRatioClass","loadedPhoto","Object","keys","meta","width","imageMeta","height","ViewAddress","localImages","setLocalImages","db","Array","isArray","image","style","backgroundImage","thumbnail_src","ajaxLoaderGray","renderTags","tagInfoFields","options","yes","no","other","commercial","residential","public","brick","concrete","wood","glass","painted","others","buildingDisrepair","weeds","trash","illegalDumping","TagInfo","setTagInfo","nameValueMap","tagInfoInputElements","fieldKey","fieldType","createRef","subFields","subRefs","subFieldKey","updateDone","updateTagInfo","mappedFieldValues","forEach","element","elementType","subElement","checked","put","formData","console","log","get","field","fieldGroup","mainIndex","defaultValue","onBlur","min","optionKeys","optionKey","htmlFor","generateInputType","OwnerInfo","ownerInfo","setOwnerInfo","formLabels","fieldKeys","inputElements","updateInfo","inputValue","ownerInfoValues","input","phone","email","tenantName","tenantPhoneNumber","waiverCompleted","needFollowUp","buildingSurveyQuestionAnswer","getOwnerInfo","formField","readOnly","subGroup","subGroupIndex","getLocalAddresses","localStorage","Promise","resolve","getLocalTags","getLocalOwnerInfo","ownerInfos","getTagInfo","tagInfos","bundleData","bundledData","count","deletedAddresses","timeLog","syncUp","headers","Authorization","status","response","msg","syncDown","isLocalStorageEmpty","syncUserData","updateLocalStorageFromSync","updateLocalAddresses","remoteData","addressRow","updateLocalTags","tagRow","tagMeta","JSON","parse","address_id","fileName","updateLocalOwnerInfo","ownerInfoRow","form_data","updateLocalTagInfo","tagInfoRow","deleteLocalData","delete","resizeAdjustHeight","document","querySelector","innerHeight","deleteAddress","addressObj","finishedDeletingAddress","backupDelFailTimer","doneDeleting","clearTimeout","deleteAddressTagInfo","dbOpened","deleteAddressTags","deleteAddressRow","deleteAddressOwnerInfo","setTimeout","BottomNavbar","syncBtn","logoutBtn","cameraBtn","uploadBtn","deletingAddress","setDeletingAddress","logout","updateLoggingOut","saveToDevice","sync","appOnline","syncApp","setSyncApp","synced","uploadImages","triggerFileUpload","confirm","directCameraClick","getElementById","click","tmpArr","setDeletedAddresses","addEventListener","navigator","userAgent","classList","curPath","maxHeight","addPathClassToBody","removeEventListener","syncIcon","loggingOut","logoutIcon","deleteIcon","property","textDocument","addSquare","loadedPhotos","uploadInProgress","ajaxLoaderBlue","savingToDevice","tagPath","renderBottomNavbar","Page404","AddTag","fileInput","loadCamera","triggerLoadCamera","fileUpload","setLoadedPhotos","setSavingToDevice","setUploadInProgress","createThumbnailSrc","reject","img","Image","onload","newImageWidth","newImageHeight","canvas","createElement","ctx","getContext","drawImage","toDataURL","scaleImage","onerror","i","thumbnailSrc","oldCanvas","remove","timestamp","now","previewPhoto","reader","FileReader","file","files","result","thumbanil_src","size","readAsDataURL","setLoadedImageMeta","loadedImage","loopIndex","loadedPhotosClone","images","setBodyClass","cameraCallback","onLoad","EditTags","deletePrompt","toggleDeletePrompt","setDeleteInProgress","delFileTimeStamp","closeIcon","some","deleteCount","deleteImage","App","setToken","updateSearchedAddress","setAppOnline","setOfflineStorage","bodyClass","show","clearSearchedAddress","updateAppOnlineState","event","online","checkForNewVersion","verChecked","getItem","setItem","frontEndBasePath","error","Error","caches","names","reload","Dexie","version","stores","setupOfflineStorage","basename","component","exact","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","ReactDOM","render","URL","origin","fetch","contentType","ready","unregister","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.73fe4c33.chunk.js","sourcesContent":["module.exports = \"data:image/gif;base64,R0lGODlhEAAQAPQAAP///zg4OPn5+WNjY56enjw8PFVVVd7e3rq6uklJSZOTk4eHh+np6a6urtLS0nBwcHt7ewAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAAFUCAgjmRpnqUwFGwhKoRgqq2YFMaRGjWA8AbZiIBbjQQ8AmmFUJEQhQGJhaKOrCksgEla+KIkYvC6SJKQOISoNSYdeIk1ayA8ExTyeR3F749CACH5BAAKAAEALAAAAAAQABAAAAVoICCKR9KMaCoaxeCoqEAkRX3AwMHWxQIIjJSAZWgUEgzBwCBAEQpMwIDwY1FHgwJCtOW2UDWYIDyqNVVkUbYr6CK+o2eUMKgWrqKhj0FrEM8jQQALPFA3MAc8CQSAMA5ZBjgqDQmHIyEAIfkEAAoAAgAsAAAAABAAEAAABWAgII4j85Ao2hRIKgrEUBQJLaSHMe8zgQo6Q8sxS7RIhILhBkgumCTZsXkACBC+0cwF2GoLLoFXREDcDlkAojBICRaFLDCOQtQKjmsQSubtDFU/NXcDBHwkaw1cKQ8MiyEAIfkEAAoAAwAsAAAAABAAEAAABVIgII5kaZ6AIJQCMRTFQKiDQx4GrBfGa4uCnAEhQuRgPwCBtwK+kCNFgjh6QlFYgGO7baJ2CxIioSDpwqNggWCGDVVGphly3BkOpXDrKfNm/4AhACH5BAAKAAQALAAAAAAQABAAAAVgICCOZGmeqEAMRTEQwskYbV0Yx7kYSIzQhtgoBxCKBDQCIOcoLBimRiFhSABYU5gIgW01pLUBYkRItAYAqrlhYiwKjiWAcDMWY8QjsCf4DewiBzQ2N1AmKlgvgCiMjSQhACH5BAAKAAUALAAAAAAQABAAAAVfICCOZGmeqEgUxUAIpkA0AMKyxkEiSZEIsJqhYAg+boUFSTAkiBiNHks3sg1ILAfBiS10gyqCg0UaFBCkwy3RYKiIYMAC+RAxiQgYsJdAjw5DN2gILzEEZgVcKYuMJiEAOwAAAAAAAAAAAA==\"","module.exports = __webpack_public_path__ + \"static/media/property.8673af4c.svg\";","module.exports = __webpack_public_path__ + \"static/media/text-document.e93f329b.svg\";","module.exports = \"data:image/gif;base64,R0lGODlhEAAQAPQAAP///xuJ/fj7/U2i/ZDF/SCL/Tya/drr/bHW/S6T/YS//Xa3/eby/aLP/cvk/Vuq/Wew/QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAAFUCAgjmRpnqUwFGwhKoRgqq2YFMaRGjWA8AbZiIBbjQQ8AmmFUJEQhQGJhaKOrCksgEla+KIkYvC6SJKQOISoNSYdeIk1ayA8ExTyeR3F749CACH5BAAKAAEALAAAAAAQABAAAAVoICCKR9KMaCoaxeCoqEAkRX3AwMHWxQIIjJSAZWgUEgzBwCBAEQpMwIDwY1FHgwJCtOW2UDWYIDyqNVVkUbYr6CK+o2eUMKgWrqKhj0FrEM8jQQALPFA3MAc8CQSAMA5ZBjgqDQmHIyEAIfkEAAoAAgAsAAAAABAAEAAABWAgII4j85Ao2hRIKgrEUBQJLaSHMe8zgQo6Q8sxS7RIhILhBkgumCTZsXkACBC+0cwF2GoLLoFXREDcDlkAojBICRaFLDCOQtQKjmsQSubtDFU/NXcDBHwkaw1cKQ8MiyEAIfkEAAoAAwAsAAAAABAAEAAABVIgII5kaZ6AIJQCMRTFQKiDQx4GrBfGa4uCnAEhQuRgPwCBtwK+kCNFgjh6QlFYgGO7baJ2CxIioSDpwqNggWCGDVVGphly3BkOpXDrKfNm/4AhACH5BAAKAAQALAAAAAAQABAAAAVgICCOZGmeqEAMRTEQwskYbV0Yx7kYSIzQhtgoBxCKBDQCIOcoLBimRiFhSABYU5gIgW01pLUBYkRItAYAqrlhYiwKjiWAcDMWY8QjsCf4DewiBzQ2N1AmKlgvgCiMjSQhACH5BAAKAAUALAAAAAAQABAAAAVfICCOZGmeqEgUxUAIpkA0AMKyxkEiSZEIsJqhYAg+boUFSTAkiBiNHks3sg1ILAfBiS10gyqCg0UaFBCkwy3RYKiIYMAC+RAxiQgYsJdAjw5DN2gILzEEZgVcKYuMJiEAOwAAAAAAAAAAAA==\"","module.exports = __webpack_public_path__ + \"static/media/chevron-blue.f48ced71.svg\";","module.exports = __webpack_public_path__ + \"static/media/tagging-tracker-logo.4295bb0d.PNG\";","module.exports = __webpack_public_path__ + \"static/media/chevron.8417a1be.svg\";","module.exports = __webpack_public_path__ + \"static/media/upload.d4af3f99.svg\";","module.exports = __webpack_public_path__ + \"static/media/switch.e4b4aac4.svg\";","module.exports = __webpack_public_path__ + \"static/media/add-square.00e36f36.svg\";","module.exports = __webpack_public_path__ + \"static/media/delete.665926e2.svg\";","module.exports = __webpack_public_path__ + \"static/media/close.db093ba0.svg\";","import React, { useState, useEffect } from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\nimport './EditTags.scss';\r\nimport { getImagePreviewAspectRatioClass } from './../../utils/image';\r\nimport closeIcon from './../../assets/icons/svgs/close.svg';\r\nimport ajaxLoaderGray from './../../assets/gifs/ajax-loader--gray.gif';\r\n\r\n// TODO this is bad but poor design\r\nlet fileNameOfImageToDelete;\r\nlet fileTimeStamp; // these should be grouped together\r\n\r\nconst EditTags = (props) => {\r\n    const offlineStorage = props.offlineStorage;\r\n    const history = useHistory();\r\n    const [localImages, setLocalImages] = useState(null);\r\n    const [deletePrompt, toggleDeletePrompt] = useState(false);\r\n    const [deleteInProgress, setDeleteInProgress] = useState(false); // eslint-disable-line\r\n    \r\n    if (typeof props.location.state === \"undefined\") {\r\n        history.push(\"/addresses\");\r\n    }\r\n\r\n    const deleteImage = (addressId, fileName, fileTimeStamp) => {   \r\n        offlineStorage.transaction('rw', offlineStorage.tags, () => {\r\n            if (\r\n                offlineStorage.tags.where(\"addressId\").equals(addressId).toArray()\r\n                    .then((images) => {\r\n                        images.some((image) => { // eslint-disable-line\r\n\r\n                            if (!fileTimeStamp && image.fileName === fileName) {\r\n                                offlineStorage.tags.where(\"fileName\").equals(fileName).delete().then((deleteCount) => {\r\n                                    if (deleteCount) {\r\n                                        offlineStorage.tags\r\n                                            .where(\"addressId\").equals(props.location.state.addressId)\r\n                                            .toArray().then((tags) => {\r\n                                                setLocalImages(tags);\r\n                                            });\r\n                                    }\r\n                                })\r\n                            } else if (image.timestamp && fileTimeStamp === image.timestamp) { // make sure comparison image has a timestamp, backwards compatability\r\n                                offlineStorage.tags.where(\"timestamp\").equals(fileTimeStamp).delete().then((deleteCount) => {\r\n                                    if (deleteCount) {\r\n                                        offlineStorage.tags\r\n                                            .where(\"addressId\").equals(props.location.state.addressId)\r\n                                            .toArray().then((tags) => {\r\n                                                setLocalImages(tags);\r\n                                            });\r\n                                    }\r\n                                })\r\n                            }\r\n                        })\r\n                    })\r\n                    .catch((e) => {\r\n                        console.log('deleted tag', e);\r\n                        return false;\r\n                    })\r\n            ) {\r\n                setDeleteInProgress(true);\r\n            } else {\r\n                alert('Failed to delete tag');\r\n            }\r\n        })\r\n        .catch(e => {\r\n            alert('Failed to delete tag');\r\n            console.log('delete tag', e);\r\n        });\r\n    }\r\n\r\n    const showDeletePrompt = (fileName, delFileTimeStamp) => {\r\n        fileNameOfImageToDelete = fileName;\r\n        fileTimeStamp = delFileTimeStamp;\r\n        toggleDeletePrompt(true);\r\n    }\r\n\r\n    const renderDeletePrompt = (addressId, fileName, timestamp) => {\r\n        return (\r\n            <div className={\"tagging-tracker__edit-tags-delete-prompt\" + (deletePrompt ? \"\" : \" hidden\")}>\r\n                <h4>Delete Tag {fileName}</h4>\r\n                <p>This will delete all information and photos of the tag</p>\r\n                <div className=\"edit-tags-delete-prompt__delete-btns\">\r\n                    <button onClick={() => { deleteImage(addressId, fileName, timestamp) }} className=\"delete-btns__delete\" type=\"button\">Delete</button>\r\n                    <button onClick={() => { toggleDeletePrompt(false) }} className=\"delete-btns__cancel\" type=\"button\">Cancel</button>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    const renderTags = () => {\r\n        if (offlineStorage && !localImages) {\r\n            offlineStorage.open().then(function (offlineStorage) {\r\n                offlineStorage.tags.toArray().then((tags) => {\r\n                    !tags.length\r\n                        ? setLocalImages([])\r\n                        :  offlineStorage.tags\r\n                            .where(\"addressId\").equals(props.location.state.addressId)\r\n                            .toArray().then((tags) => {\r\n                                setLocalImages(tags);\r\n                            });\r\n                });\r\n            }).catch (function (err) {\r\n                // handle this failure correctly\r\n                alert('failed to open local storage');\r\n            });\r\n        }\r\n        \r\n        if (Array.isArray(localImages)) {\r\n            return localImages.map((image, index) => {\r\n                return <div key={ index }\r\n                    style={{\r\n                        backgroundImage: `url(${image.thumbnail_src})`\r\n                    }} alt=\"address thumbnail\"\r\n                    onClick={ () => { showDeletePrompt(image.meta.name, image.timestamp) } }\r\n                    className={ \"address__tag-image delete \" + getImagePreviewAspectRatioClass(localImages[index]) }>\r\n                    <div style={{ backgroundImage: `url(${closeIcon})` }} className=\"tagging-tracker__edit-tags-close-btn\"></div>\r\n                </div>\r\n            });\r\n        } else {\r\n            return <div className=\"tagging-tracker__edit-tags-loading css-delayed-fade-in\">\r\n                <span>Loading tags...</span>\r\n                <img src={ ajaxLoaderGray } alt=\"loading tags spinner\" />\r\n            </div>;\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (fileNameOfImageToDelete) {\r\n            fileNameOfImageToDelete = \"\";\r\n            fileTimeStamp = null;\r\n        }\r\n        toggleDeletePrompt(false);\r\n    }, [localImages]);\r\n    \r\n    // TODO this code is almost an exact copy of ViewAddress may have flexed states\r\n    // I used same class to steal styling\r\n    return(\r\n        <div className=\"tagging-tracker__edit-tags tagging-tracker__view-address\">\r\n            { renderTags() }\r\n            { renderDeletePrompt(props.location.state.addressId, fileNameOfImageToDelete, fileTimeStamp) }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default EditTags;","export const getDateTime = (format = \"\") => {\r\n    // from https://stackoverflow.com/questions/8083410/how-can-i-set-the-default-timezone-in-node-js\r\n    process.env.TZ = \"America/Chicago\";\r\n    let date_ob = new Date();\r\n\r\n    // current date\r\n    // adjust 0 before single digit date\r\n    let date = (\"0\" + date_ob.getDate()).slice(-2);\r\n\r\n    // current month\r\n    let month = (\"0\" + (date_ob.getMonth() + 1)).slice(-2);\r\n\r\n    // current year\r\n    let year = date_ob.getFullYear();\r\n\r\n    // current hours\r\n    let hours = date_ob.getHours();\r\n\r\n    // current minutes\r\n    let minutes = date_ob.getMinutes();\r\n\r\n    // current seconds\r\n    let seconds = date_ob.getSeconds();\r\n    \r\n    if (format === \"YYYY-MM-DD\") {\r\n        return `${year}-${month}-${date}`;\r\n    }\r\n\r\n    if (format === \"MM-DD-YYYY\") {\r\n        return `${month}-${date}-${year}`;\r\n    }\r\n\r\n    // prints date & time in YYYY-MM-DD HH:MM:SS format\r\n    return `${year}-${month}-${date} ${hours}:${minutes}:${seconds}`;\r\n}\r\n\r\nexport const getTimeStamp = () => {\r\n    return Date.now();\r\n}","import React, { useRef, useEffect, useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport './Navbar.scss';\r\n\r\nimport backArrow from './../../assets/icons/svgs/chevron-blue.svg'; // rotated by CSS\r\n\r\nconst Navbar = (props) => {\r\n    const searchAddressInput = useRef(null);\r\n    const [showSettings, setShowSettings] = useState(false);\r\n\r\n    const searchAddresses = (searchStr) => {\r\n        props.searchAddress(searchStr);\r\n    }\r\n\r\n    const getNavTitle = (path, address) => {\r\n        let navTitle = \"\";\r\n\r\n        if (path === \"/tag-info\") {\r\n            navTitle = \"Tag Information\";\r\n        } else if (path === \"/owner-info\") {\r\n            navTitle = \"Owner Information\";\r\n        } else {\r\n            navTitle = address;\r\n        }\r\n\r\n        return navTitle;\r\n    }\r\n\r\n    const getBackButtonTitle = (path, address) => {\r\n        if (path === \"/tag-info\" || path === \"owner-info\" || path === \"/add-tag\" || path === \"/edit-tags\") {\r\n            let addressOutput = address.substring(0, 10);\r\n\r\n            if (address.length > 10) {\r\n                addressOutput += \"...\";\r\n            }\r\n\r\n            return addressOutput;\r\n        } else {\r\n            return \"Addresses\";\r\n        }\r\n    }\r\n\r\n    const getBackPathname = (path) => {\r\n        if (path === \"/tag-info\" || path === \"/owner-info\" || path === \"/edit-tags\" || path === \"/add-tag\") {\r\n            return \"/view-address\";\r\n        } else {\r\n            return \"/addresses\"\r\n        }\r\n    }\r\n\r\n    const getBackState = (path) => {\r\n        return {\r\n            clearSearch: true,\r\n            address: props.location.state.address,\r\n            addressId: props.location.state.addressId\r\n        };\r\n    }\r\n\r\n    const editSaveOwnerInfo = () => {\r\n        props.toggleModifyOwnerInfo(!props.modifyOwnerInfo);\r\n    }\r\n\r\n    const editTagInfo = () => {\r\n        props.toggleModifyTagInfo(!props.modifyTagInfo);\r\n    }\r\n\r\n    const generateEditBtn = () => {\r\n        const pathname = props.location.pathname;\r\n        const isEditTagsPath = pathname.indexOf('edit') !== -1;\r\n        const isAddTagPath = pathname.indexOf('add-tag') !== -1;\r\n\r\n        if (pathname === \"/owner-info\") {\r\n            return (\r\n                <button\r\n                    type=\"button\"\r\n                    className=\"manage-address__edit-cancel\"\r\n                    onClick={ editSaveOwnerInfo }\r\n                >{ props.modifyOwnerInfo ? \"SAVE\" : \"EDIT\" }</button> // TODO: this should flex between save/edit/cancel if changes occurred\r\n            );\r\n        } \r\n        else if (pathname === \"/tag-info\") {\r\n            return (\r\n                <button\r\n                    type=\"button\"\r\n                    className=\"manage-address__edit-cancel\"\r\n                    onClick={ editTagInfo }\r\n                >{ props.modifyTagInfo ? \"SAVE\" : \"EDIT\" }</button> // TODO: this should flex between save/edit/cancel if changes occurred\r\n            );\r\n        } else {\r\n            return (\r\n                <Link to={{ pathname: isEditTagsPath ? \"view-address\" : \"/edit-tags\", state: { \r\n                    address: props.location.state.address,\r\n                    addressId: props.location.state.addressId\r\n                }}} className=\"manage-address__edit-cancel\">{\r\n                    isAddTagPath ? \"\" : (isEditTagsPath ? \"Cancel\" : \"Delete\")\r\n                }</Link>\r\n            );\r\n        }\r\n    }\r\n\r\n    const toggleSettings = () => {\r\n        setShowSettings(!showSettings);\r\n    }\r\n\r\n    const generateSettingsMenu = (show) => {\r\n        if (!show) {\r\n            return null;\r\n        }\r\n\r\n        return <div className=\"navbar-top__settings-menu\">\r\n            <button onClick={ props.updateSoftware } type=\"button\">Update Software</button>{/* LOL */}\r\n        </div>;\r\n    }\r\n\r\n    const renderNavbar = (routeLocation) => {\r\n        const routePath = props.baseDir ? routeLocation.pathname.replace(props.baseDir + \"/\", \"\") : routeLocation.pathname;\r\n        switch(routePath) {\r\n            case '/':\r\n            case '/addresses':\r\n                return <>\r\n                    <div className=\"tagging-tracker__navbar-top addresses\">\r\n                        <button className=\"add\" onClick={  () => {props.toggleAddressModal(true)}  } />\r\n                        <h2>Addresses</h2>\r\n                        <div className=\"navbar-top__settings\">\r\n                            <button className=\"gear-icon\" type=\"button\" onClick={ toggleSettings }></button>\r\n                            { generateSettingsMenu(showSettings) }\r\n                        </div>\r\n                    </div>\r\n                    <input type=\"text\" value={props.searchedAddress} placeholder=\"search\" ref={ searchAddressInput } onChange={ (e) => { searchAddresses(e.target.value)} }></input>\r\n                </>;\r\n            case '/view-address':\r\n            case '/edit-tags':\r\n            case '/add-tag':\r\n            case '/tag-info':\r\n            case '/owner-info':\r\n                return <>\r\n                    <div className=\"tagging-tracker__navbar-top view-address edit-tags add-tags\">\r\n                        <Link to={{ pathname: getBackPathname(routeLocation.pathname), state: getBackState(routeLocation.pathname)}} className=\"manage-address__back\">\r\n                            <img src={ backArrow } alt=\"back arrow\" />\r\n                        <h4>{ getBackButtonTitle(routeLocation.pathname, props.location.state.address) }</h4>\r\n                        </Link>\r\n                        <h2 className=\"manage-address__name\">\r\n                            { getNavTitle(routeLocation.pathname, props.location.state.address) }\r\n                        </h2>\r\n                        { generateEditBtn() }\r\n                    </div>\r\n                </>;\r\n            default:\r\n                return \"\";\r\n        }\r\n    };\r\n\r\n    // focus\r\n    useEffect(() => {\r\n        if (!props.showAddressModal && props.location.pathname === \"/addresses\" && searchAddressInput.current.value.length > 0) {\r\n            searchAddressInput.current.focus();\r\n        }\r\n\r\n        // update online/offline status\r\n        props.checkOnlineStatus();\r\n    });\r\n\r\n    return(\r\n        <div className=\"tagging-tracker__navbar\">\r\n            { renderNavbar(props.location) }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Navbar;","import React, { useRef, useState, useEffect } from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\nimport './Login.scss';\r\nimport taggingTrackerLogo from './../../assets/images/tagging-tracker-logo.PNG';\r\nimport axios from 'axios';\r\n\r\nconst Login = (props) => {\r\n    const usernameInput = useRef(null);\r\n    const passwordInput = useRef(null);\r\n    const loginBtn = useRef(null);\r\n    const history = useHistory();\r\n    const [loginProcessing, setLoginProcessing] = useState(false);\r\n\r\n    const login = () => {\r\n        const baseApiPath = window.location.href.indexOf('localhost') !== -1\r\n                ? process.env.REACT_APP_API_BASE_LOCAL\r\n                : process.env.REACT_APP_API_BASE;\r\n        const postUrl = baseApiPath + '/login-user';\r\n        const username = usernameInput.current.value;\r\n        const password = passwordInput.current.value;\r\n\r\n        if (!username || !password) {\r\n            alert('Please fill in both username and password to login');\r\n            return;\r\n        }\r\n\r\n        setLoginProcessing(true);\r\n\r\n        axios.post(postUrl, {\r\n            username,\r\n            password\r\n        })\r\n        .then((res) => {\r\n            if (typeof res.data.token !== \"undefined\" && res.data.token) {\r\n                props.updateToken(res.data.token);\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            alert('failed to login'); // 401 goes through here too\r\n            setLoginProcessing(false);\r\n        });\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (props.token) {\r\n            history.push(\"/addresses\");\r\n        }\r\n    });\r\n\r\n    return(\r\n        <div className=\"tagging-tracker__login\">\r\n            <img alt=\"tagging tracker logo\" className=\"tagging-tracker__login-logo\" src={ taggingTrackerLogo } />\r\n            <div className=\"tagging-tracker__login-fields\">\r\n                <input type=\"text\" name=\"username\" placeholder=\"username\" ref={ usernameInput } />\r\n                <input type=\"password\" name=\"password\" placeholder=\"password\" ref={ passwordInput } />\r\n                <button type=\"button\" onClick={ login } ref={ loginBtn } disabled={ loginProcessing ? true : false }>Login</button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Login;","import React, { useRef, useEffect, useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport './Addresses.scss';\r\nimport rightArrow from './../../assets/icons/svgs/chevron.svg';\r\n\r\nconst Addresses = (props) => {\r\n    const newAddressInput = useRef(null);\r\n    const cancelAddAddressBtn = useRef(null);\r\n    const createAddressBtn = useRef(null);\r\n    const [addAddressProcessing, setAddAddressProcessing] = useState(false);\r\n    const [recentAddresses] = useState([]);\r\n    const [activeAddresses, setActiveAddresses] = useState(null);\r\n    \r\n    // this search may need to get restructured depending on what's available/important to search against\r\n    // versus the obvious address field, but tag search is something based on the tag text\r\n    // I will implement an address-first then tag search, this is not going to be as optimized/fast as plain SQL\r\n    // also I have not done any indexing this is just using regular tables/main parent\r\n    // more info here:\r\n    // https://dexie.org/docs/WhereClause/WhereClause, https://dexie.org/docs/Table/Table.filter(), https://dexie.org/docs/Table/Table.where()\r\n    const searchAddresses = (searchStr) => {\r\n        const offlineStorage = props.offlineStorage;\r\n\r\n        if (!offlineStorage) {\r\n            return; // offline storage not ready yet\r\n        }\r\n\r\n        // the /string/ pattern is a regex, can't make one from concatenating plain strings\r\n        const regex = new RegExp(searchStr, \"i\"); // case insensitive\r\n\r\n        // this is similar to a LIKE search https://github.com/dfahlander/Dexie.js/issues/146\r\n        // other alternatives like .where(\"address\").startsWith(searchStr)\r\n        let addressesFormatted;\r\n        offlineStorage.addresses.filter(address => regex.test(address.address))\r\n            .toArray().then((addresses) => {\r\n                if (!addresses.length) {\r\n                    // try searching by tags\r\n                    offlineStorage.tagInfo.filter(tag => regex.test(tag.tagText)).toArray().then((tags) => {\r\n                        addressesFormatted = tags.map((tag) => {\r\n                            return {\r\n                                // not sure if this will work\r\n                                address: offlineStorage.addresses.where(\"id\").equals(tag.addressId).toArray().then((addresses) => {\r\n                                        return addresses[0].id\r\n                                    }),\r\n                                addressId: tag.addressId\r\n                            };\r\n                        });\r\n                    });\r\n                } else {\r\n                    addressesFormatted = addresses.map((address) => {\r\n                        return {\r\n                            address: address.address,\r\n                            addressId: address.id\r\n                        };\r\n                    });\r\n                }\r\n\r\n\t\t\t\tsetActiveAddresses(addressesFormatted);\r\n            });\r\n    }\r\n\r\n    const checkAddressExists = () => {\r\n        const addressStr = newAddressInput.current.value;\r\n        const offlineStorage = props.offlineStorage;\r\n\r\n        offlineStorage.open().then((offlineStorage) => {\r\n            offlineStorage.addresses.toArray().then((addresses) => {\r\n                !addresses.length\r\n                    ? saveAddress(addressStr)\r\n                    :  offlineStorage.addresses\r\n                        .where(\"address\").equals(addressStr)\r\n                        .toArray().then((addresses) => {\r\n                            addresses.length ? alert('Address exists') : saveAddress(addressStr);\r\n                        });\r\n            });\r\n        }).catch (function (err) {\r\n            // handle this failure correctly\r\n            alert('failed to open local storage');\r\n        });\r\n    }\r\n\r\n    const saveAddress = async (addressStr) => {\r\n        const offlineStorage = props.offlineStorage;\r\n\r\n        if (!addressStr) {\r\n            alert('Please enter an address');\r\n            return;\r\n        }\r\n\r\n        setAddAddressProcessing(true);\r\n\r\n        // check if address is in table already\r\n        offlineStorage.transaction('rw', offlineStorage.addresses, async() => {\r\n            let newRowId;\r\n\r\n            if (\r\n                await offlineStorage.addresses.add({\r\n                    address: addressStr,\r\n                    lat: \"0.0\", // turn to float when uploaded\r\n                    lng: \"0.0\", // turn to float when uploaded\r\n                    created: props.getDateTime(),\r\n                    updated: props.getDateTime()\r\n                }).then((insertedId) => {\r\n                    newRowId = insertedId;\r\n                    return true;\r\n                })\r\n            ) {\r\n                setActiveAddresses(recentAddresses.concat({\r\n                    address: addressStr,\r\n                    addressId: newRowId\r\n                }));\r\n                setAddAddressProcessing(false);\r\n                props.setShowAddressModal(false);\r\n            } else {\r\n                alert('Failed to save address');\r\n            }\r\n        })\r\n        .catch(e => {\r\n            alert('Failed to save address');\r\n        });\r\n    }\r\n\r\n    const loadRecentAddresses = () => {\r\n        // returns last 10 addresses used by updated date sorted descending\r\n        if (!recentAddresses.length && props.offlineStorage) {\r\n            props.offlineStorage.addresses.toArray().then((addresses) => {\r\n                // format data\r\n                const addressesFormatted = addresses.splice(0, 15).map((address) => {\r\n                    return {\r\n                        address: address.address,\r\n                        addressId: address.id\r\n                    };\r\n                });\r\n\r\n\t\t\t\tsetActiveAddresses(addressesFormatted);\r\n\t\t\t});\r\n        }\r\n    }\r\n\r\n    const addNewAddressModal = (showModal) => {\r\n        return showModal ? (\r\n            <div className=\"tagging-tracker__address-input-modal\">\r\n                <h3>Create New Address</h3>\r\n                <p>Please enter a new address that you want to create</p>\r\n                <input type=\"text\" ref={ newAddressInput } />\r\n                <div className=\"tagging-tracker__address-input-modal-btns\">\r\n                    <button type=\"button\" ref={ cancelAddAddressBtn } onClick={ () => {props.toggleAddressModal(false)} } >CANCEL</button>\r\n                    <button type=\"button\" ref={ createAddressBtn } onClick={ checkAddressExists } disabled={ addAddressProcessing ? true : false }>CREATE</button>\r\n                </div>\r\n            </div>\r\n        ) : null;\r\n    }\r\n\r\n    const renderActiveAddresses = () => {\r\n        if (!activeAddresses) {\r\n            return \"\";\r\n        } else {\r\n            return (activeAddresses.map((address, index) => {\r\n                return <Link\r\n                    key={index}\r\n                    to={{ pathname: \"/view-address\", state: {\r\n                            address: address.address,\r\n                            addressId: address.addressId // used for lookup\r\n                    }}}\r\n                    className=\"tagging-tracker__address\">\r\n                        <h4>{ address.address }</h4>\r\n                        <img src={ rightArrow } alt=\"right arrow\" />\r\n                </Link>}));\r\n        }\r\n    }\r\n\r\n    // focus\r\n    useEffect(() => {\r\n        if (props.showAddressModal) {\r\n            newAddressInput.current.focus();\r\n        }\r\n\r\n        // this detects when route changed from a single address back to addresses and clears the search input\r\n        // there are no hard routes eg. using Link so the parent state does not change\r\n        if (typeof props.location.state !== \"undefined\" &&\r\n            typeof props.location.state.clearSearch !== \"undefined\") {\r\n            delete props.location.state.clearSearch; // lol without this non-ending loop\r\n            props.clearSearchAddress();\r\n        }\r\n\r\n        if (recentAddresses) {\r\n            setAddAddressProcessing(false);\r\n        }\r\n    }, [props, recentAddresses]);\r\n\r\n    useEffect(() => {\r\n        if (props.searchedAddress.length) {\r\n            searchAddresses(props.searchedAddress);\r\n        } else if (props.offlineStorage) {\r\n            loadRecentAddresses(); // TODO unmounted state issue\r\n        }\r\n    });\r\n\r\n    return(\r\n        <div className=\"tagging-tracker__addresses\">\r\n            { renderActiveAddresses() }\r\n            { addNewAddressModal(props.showAddressModal) }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Addresses;","// skipping this for now, using CSS contain to fit image, does the same thing\r\n// TODO: investigate issue with state and image meta not getting set\r\n// this works in delete mode eg. EditTags.js as the meta dimentions exist\r\nexport const getImagePreviewAspectRatioClass = (loadedPhoto) => {\r\n    const imageMetaSet = Object.keys(loadedPhoto.meta).length;\r\n\r\n    if (imageMetaSet && typeof loadedPhoto.meta.width !== \"undefined\") {\r\n        const imageMeta = loadedPhoto.meta;\r\n        return (imageMeta.width >= imageMeta.height) // flipped\r\n            ? \"landscape\"\r\n            : \"portrait\";\t\r\n    } else {\r\n        return \"\";\r\n    }\r\n}","import React, { useState  } from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\nimport './ViewAddress.scss';\r\nimport { getImagePreviewAspectRatioClass } from './../../utils/image';\r\nimport ajaxLoaderGray from './../../assets/gifs/ajax-loader--gray.gif';\r\n\r\nconst ViewAddress = (props) => {\r\n    const history = useHistory();\r\n    const [localImages, setLocalImages] = useState(null);\r\n    \r\n    if (typeof props.location.state === \"undefined\") {\r\n        history.push(\"/addresses\");\r\n    }\r\n\r\n    const renderTags = () => {\r\n        const db = props.offlineStorage;\r\n\r\n        if (db && !localImages) {\r\n            db.open().then(function (db) {\r\n                db.tags.toArray().then((tags) => {\r\n                    !tags.length\r\n                        ? setLocalImages([])\r\n                        :  db.tags\r\n                        .where(\"addressId\").equals(props.location.state.addressId)\r\n                        .toArray().then((tags) => {\r\n                            setLocalImages(tags);\r\n                        });\r\n                });\r\n            }).catch (function (err) {\r\n                // handle this failure correctly\r\n                alert('failed to open local storage');\r\n            });\r\n        }\r\n        \r\n        if (Array.isArray(localImages)) {\r\n            return localImages.map((image, index) => {\r\n                return <div key={ index } style={{\r\n                    backgroundImage: `url(${image.thumbnail_src})`\r\n                }} alt=\"address thumbnail\" className={ \"address__tag-image \" + getImagePreviewAspectRatioClass(localImages[index]) } />\r\n            });\r\n        } else {\r\n            return <div className=\"tagging-tracker__view-address-loading css-delayed-fade-in\">\r\n                <span>Loading tags...</span>\r\n                <img src={ ajaxLoaderGray } alt=\"loading tags spinner\" />\r\n            </div>;\r\n        }\r\n    }\r\n\r\n    return(\r\n        <div className=\"tagging-tracker__view-address\">\r\n            { renderTags() }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default ViewAddress;","export const tagInfoFields = {\r\n    \"Date of picture:\": { // TODO: these should be date time with date pickers\r\n        type: \"date\"\r\n    },\r\n    \"Date of abatement:\": { // TODO: these should be date time with date pickers\r\n        type: \"date\"\r\n    },\r\n    \"Number of tags:\": {\r\n        type: \"number\"\r\n    },\r\n    \"Tag text:\": {\r\n        type: \"input\"\r\n    },\r\n    \"Small tag text:\": {\r\n        type: \"input\"\r\n    },\r\n    \"Square footage covered:\": {\r\n        type: \"number\"\r\n    },\r\n    \"Racial or hate tone?\": {\r\n        type: \"radio\",\r\n        options: {\r\n            yes: \"Yes\",\r\n            no: \"No\",\r\n            other: \"Other\"\r\n        }\r\n    },\r\n    \"Gang related\": {\r\n        type: \"radio\",\r\n        options: {\r\n            yes: \"Yes\",\r\n            no: \"No\",\r\n            other: \"Other\"\r\n        }\r\n    },\r\n    \"Crossed out tag\": {\r\n        type: \"radio\",\r\n        options: {\r\n            yes: \"Yes\",\r\n            no: \"No\",\r\n            other: \"Other\"\r\n        }\r\n    },\r\n    \"Type of property\": {\r\n        type: \"radio\",\r\n        options: {\r\n            commercial: \"Commercial\",\r\n            residential: \"Residential\",\r\n            public: \"Public\"\r\n        }\r\n    },\r\n    \"Vacant property\": {\r\n        type: \"radio\",\r\n        options: {\r\n            yes: \"Yes\",\r\n            no: \"No\",\r\n            other: \"unknown\"\r\n        }\r\n    },\r\n    \"Land bank property\": {\r\n        type: \"radio\",\r\n        options: {\r\n            yes: \"Yes\",\r\n            no: \"No\",\r\n            other: \"unknown\"\r\n        }\r\n    },\r\n    \"Surface:\": {\r\n        type: \"checkbox\",\r\n        options: {\r\n            brick: \"Brick or Stone\",\r\n            concrete: \"Concrete\",\r\n            wood: \"Wood\",\r\n            glass: \"Glass\",\r\n            painted: \"Painted\",\r\n            others: \"other\"\r\n        }\r\n    },\r\n    \"Surface other:\": {\r\n        type: \"input\"\r\n    },\r\n    \"Need other code enforcement?\": {\r\n        type: \"checkbox\",\r\n        options: {\r\n            buildingDisrepair: \"Building disrepair\",\r\n            weeds: \"Weeds\",\r\n            trash: \"Trash\",\r\n            illegalDumping: \"Illegal dumping\",\r\n            others: \"other\"\r\n        }\r\n    },\r\n    \"Other code enforcement:\": {\r\n        type: \"input\"\r\n    }\r\n};","import React, { createRef, useState, useRef, useEffect } from 'react';\r\nimport './TagInfo.scss';\r\n\r\nimport { getDateTime } from './../../utils/date';\r\nimport { tagInfoFields } from './../../utils/tagFields';\r\n\r\n// TODO: there is this functionality of \"Others: type here\" but that will take some work to make a dynamic input field\r\n\r\n/**\r\n * So this is probably pretty confusing I get that, I was trying to make dynamic forms which it does work pretty well but has verbose code\r\n * The field types and values are defined in a util file called tagFields.js\r\n * The tagInfoFieldKeys below are used to map the refs so the inputs can be selected(for getting current value)\r\n * The nameValueMap is used to map the values for render\r\n * The main things to keep in mind is your tagFields.js structure has to match the structures here\r\n * Note the option-#-# when nested values are inside an input group eg. radio/checkbox you increment the sub group vs. incrementing a new level\r\n * OwnerInfo is built similarly but it's much simpler since it has no depth and just text input\r\n * @param {Object} props \r\n */\r\nconst TagInfo = (props) => {\r\n    const [tagInfo, setTagInfo] = useState(null);\r\n\r\n    // these have to match the order of the keys in tagFields.js\r\n    const tagInfoFieldKeys = {\r\n        \"Date of picture:\": \"\", // TODO - change to type date\r\n        \"Date of abatement:\": \"\", // TODO - change to type date, picker is extra but format guarding would be good\r\n        \"Number of tags:\": \"\",\r\n        \"Tag text:\": \"\",\r\n        \"Small tag text:\": \"\",\r\n        \"Square footage covered:\": \"\",\r\n        \"Racial or hate tone?\": \"\",\r\n        \"Gang related\": \"\",\r\n        \"Crossed out tag\": \"\",\r\n        \"Type of property\": \"\",\r\n        \"Vacant property\": \"\",\r\n        \"Land bank property\": \"\",\r\n        \"Surface:\": \"\",\r\n        \"Surface other:\": \"\",\r\n        \"Need other code enforcement?\": \"\",\r\n        \"Other code enforcement:\": \"\"\r\n    }\r\n\r\n    // note these options have to line up with what are in tagFields.js\r\n    // eg. 5 options here, 5 options there\r\n    // and these fields in general map with above by group\r\n    const nameValueMap = {\r\n        \"option-0\": \"dateOfPicture\",\r\n        \"option-1\": \"dateOfAbatement\",\r\n        \"option-2\": \"numberOfTags\",\r\n        \"option-3\": \"tagText\",\r\n        \"option-4\": \"smallTagText\",\r\n        \"option-5\": \"squareFootageCovered\",\r\n        \"option-6-0\": \"racialOrHateTone\",\r\n        \"option-6-1\": \"racialOrHateTone\",\r\n        \"option-6-2\": \"racialOrHateTone\",\r\n        \"option-7-0\": \"gangRelated\",\r\n        \"option-7-1\": \"gangRelated\",\r\n        \"option-7-2\": \"gangRelated\",\r\n        \"option-8-0\": \"crossedOutTag\",\r\n        \"option-8-1\": \"crossedOutTag\",\r\n        \"option-8-2\": \"crossedOutTag\",\r\n        \"option-9-0\": \"typeOfProperty\",\r\n        \"option-9-1\": \"typeOfProperty\",\r\n        \"option-9-2\": \"typeOfProperty\",\r\n        \"option-10-0\": \"vacantProperty\",\r\n        \"option-10-1\": \"vacantProperty\",\r\n        \"option-10-2\": \"vacantProperty\",\r\n        \"option-11-0\": \"landBankProperty\",\r\n        \"option-11-1\": \"landBankProperty\",\r\n        \"option-11-2\": \"landBankProperty\",\r\n        \"option-12-0\": \"surface\",\r\n        \"option-12-1\": \"surface\",\r\n        \"option-12-2\": \"surface\",\r\n        \"option-12-3\": \"surface\",\r\n        \"option-12-4\": \"surface\",\r\n        \"option-12-5\": \"surface\",\r\n        \"option-13-0\": \"otherSurface\",\r\n        \"option-14-0\": \"needOtherCodeEnforcement\",\r\n        \"option-14-1\": \"needOtherCodeEnforcement\",\r\n        \"option-14-2\": \"needOtherCodeEnforcement\",\r\n        \"option-14-3\": \"needOtherCodeEnforcement\",\r\n        \"option-14-4\": \"needOtherCodeEnforcement\",\r\n        \"option-15-0\": \"otherCodeEnforcement\"\r\n    };\r\n\r\n    // damn this is brutal but it works\r\n    const tagInfoInputElements = useRef(Object.keys(tagInfoFieldKeys).map(\r\n        // these are manually mapped based on tagFields.js not great, mainly for the nested inputs eg. radio/checkbox\r\n        (fieldKey) => {\r\n            const fieldType = tagInfoFields[fieldKey].type;\r\n            if (fieldType === \"input\" || fieldType === \"number\" || fieldType === \"date\") {\r\n                return createRef();\r\n            } else {\r\n                const subFields = tagInfoFields[fieldKey].options;\r\n\r\n                return {subRefs: \r\n                    Object.keys(subFields).map((subFieldKey) => {\r\n                        return createRef();\r\n                    })\r\n                };\r\n            }\r\n        }\r\n    ));\r\n\r\n    let updateDone = true; // bad\r\n\r\n    const updateTagInfo = () => {\r\n        const offlineStorage = props.offlineStorage;\r\n        const mappedFieldValues = {}\r\n\r\n        tagInfoInputElements.current.forEach((element) => {\r\n            let elementType = \"\";\r\n\r\n            if (typeof element.current !== \"undefined\" && typeof element.current.type !== \"undefined\") {\r\n                elementType = element.current.type;\r\n            }\r\n\r\n            if (typeof element.subRefs !== \"undefined\" && Array.isArray(element.subRefs)) {\r\n                element.subRefs.forEach((subElement) => {\r\n                    mappedFieldValues[subElement.current.id] = subElement.current.checked;\r\n                });\r\n            } else if (elementType === \"text\" || elementType === \"number\" || elementType === \"date\") {\r\n                mappedFieldValues[element.current.name] = element.current.value;\r\n            } else {\r\n                mappedFieldValues[element.current.name] = element.current.checked;\r\n            }\r\n        });\r\n\r\n        if (updateDone) {\r\n            updateDone = false;\r\n        \r\n            offlineStorage.transaction('rw', offlineStorage.tagInfo, async() => {\r\n                if (\r\n                    await offlineStorage.tagInfo.put({\r\n                        addressId: props.location.state.addressId,\r\n                        formData: mappedFieldValues\r\n                    }, props.location.state.addressId).then((insertedId) => {\r\n                        return true;\r\n                    })\r\n                ) {\r\n                    updateDone = true;\r\n                    setTagInfo(mappedFieldValues);\r\n                } else {\r\n                    alert('Failed to update tag information');\r\n                }\r\n            })\r\n            .catch(e => {\r\n                alert('Failed to update tag information');\r\n                console.log('tag info', e);\r\n            });\r\n        }\r\n    }\r\n\r\n    const generateInputType = (fieldGroup, mainIndex, field) => {\r\n        const fieldType = fieldGroup.type;\r\n\r\n        if (fieldType === \"input\") {\r\n            nameValueMap[`option-${mainIndex}`] = null;\r\n            return (\r\n                <input defaultValue={ tagInfo ? tagInfo[`option-${mainIndex}`] : \"\" } name={ `option-${mainIndex}` } onBlur={ updateTagInfo } ref={tagInfoInputElements.current[mainIndex]} className=\"grow\" type=\"text\" disabled={ props.modifyTagInfo ? false : true } />\r\n            )\r\n        } else if (fieldType === \"number\") {\r\n            nameValueMap[`option-${mainIndex}`] = null;\r\n            return (\r\n                <input defaultValue={ tagInfo ? tagInfo[`option-${mainIndex}`] : \"\" } name={ `option-${mainIndex}` } placeholder=\"0\" onBlur={ updateTagInfo } ref={tagInfoInputElements.current[mainIndex]} className=\"grow\" type=\"number\" min=\"0\" disabled={ props.modifyTagInfo ? false : true } />\r\n            )\r\n        } else if (fieldType === \"date\") {\r\n            return (\r\n                <input defaultValue={ tagInfo ? tagInfo[`option-${mainIndex}`] : \"\" } name={ `option-${mainIndex}` } onBlur={ updateTagInfo } ref={tagInfoInputElements.current[mainIndex]} className=\"grow\" type=\"date\" min={getDateTime('MM-DD-YYYY')} disabled={ props.modifyTagInfo ? false : true } />\r\n            )\r\n        } else if (fieldType === \"radio\" || fieldType === \"checkbox\") {\r\n            const optionKeys = Object.keys(fieldGroup.options);\r\n\r\n            if (optionKeys.length) {\r\n                // TODO: redundant code here\r\n                if (fieldType === \"checkbox\") {\r\n                    return (\r\n                        <div className=\"padding-left\">\r\n                            {\r\n                                optionKeys.map((optionKey, index) => {\r\n                                    return (\r\n                                        <span key={index} className=\"option-group\">\r\n                                            <input checked={ tagInfo ? tagInfo[`option-${mainIndex}-${index}`] : false } onChange={ updateTagInfo } ref={tagInfoInputElements.current[mainIndex].subRefs[index]} id={`option-${mainIndex}-${index}`}\r\n                                                name={ `option-${mainIndex}-${index}`} type={ fieldType } disabled={ props.modifyTagInfo ? false : true } />\r\n                                            <label htmlFor={`option-${mainIndex}-${index}`}>{ fieldGroup.options[optionKey] }</label>\r\n                                        </span>\r\n                                    )\r\n                                })\r\n                            }\r\n                        </div>\r\n                    )\r\n                } else {\r\n                    return optionKeys.map((optionKey, index) => {\r\n                        return (\r\n                            <span key={index} className=\"option-group\">\r\n                                <input checked={ tagInfo ? tagInfo[`option-${mainIndex}-${index}`] : false } onChange={ updateTagInfo } id={`option-${mainIndex}-${index}`} name={ nameValueMap[`option-${mainIndex}-${index}`]}\r\n                                    ref={tagInfoInputElements.current[mainIndex].subRefs[index]} type={ fieldType } disabled={ props.modifyTagInfo ? false : true } />\r\n                                <label htmlFor={`option-${mainIndex}-${index}`}>{ fieldGroup.options[optionKey] }</label>\r\n                            </span>\r\n                        )\r\n                    });\r\n                }\r\n            }\r\n        } else {\r\n            return \"[unknown field type]\";\r\n        }\r\n    }\r\n\r\n    const getSpanClass = (fieldType) => {\r\n        if (fieldType === \"radio\") {\r\n            return \"option-group-label\";\r\n        } \r\n        if (fieldType === \"checkbox\") {\r\n            return \"full\";\r\n        } else {\r\n            return \"input-label\";\r\n        }\r\n    }\r\n\r\n    const renderTagInfo = () => {\r\n        return Object.keys(tagInfoFields).map((field, index) => {\r\n            return (\r\n                // bad\r\n                <div key={index} className={\"tag-info-field-row\" + (tagInfoFields[field].type === \"checkbox\" ? \" checkbox\" : \" box\") }>\r\n                    <span className={ getSpanClass(tagInfoFields[field].type) }>{ field }</span>\r\n                    { generateInputType(tagInfoFields[field], index, field) }\r\n                </div>\r\n            )\r\n        });\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (!tagInfo) {\r\n            const addressId = props.location.state.addressId;\r\n            const offlineStorage = props.offlineStorage;\r\n\r\n            if (addressId && offlineStorage) {\r\n                offlineStorage.tagInfo.get(addressId, (tagInfo) => {\r\n                    if (tagInfo) {\r\n                        setTagInfo(tagInfo.formData);\r\n                    }\r\n                }).catch (function (err) {\r\n                    alert('failed to load tagInfo');\r\n                    console.log('tag info', err);\r\n                });\r\n            }\r\n        }\r\n    }, [props, tagInfo]);\r\n\r\n    return(\r\n        <div className=\"tagging-tracker__tag-info\">\r\n            { renderTagInfo() }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default TagInfo;","import React, { createRef, useState, useRef, useEffect } from 'react';\r\nimport './OwnerInfo.scss';\r\n\r\nconst OwnerInfo = (props) => {\r\n    const [ownerInfo, setOwnerInfo] = useState(null);\r\n    // TODO: this will need to be reworked the striping in particular, it's just coincidence\r\n    // it works regarding the sub-group variant\r\n    // this is mapped to match the rendered input count regarding refs\r\n    // the name:value assigning comes from fieldKeys\r\n    const formLabels = [\r\n        \"Name\",\r\n        \"Phone\",\r\n        \"Email\",\r\n        \"Tenant Name\",\r\n        \"Tenant Contact Number\",\r\n        \"Waiver Completed\",\r\n        \"Need To Follow Up\",\r\n        {\r\n            \"Building Survey\": [\r\n                \"Would you continue service if you had to pay for it?\"\r\n            ]\r\n        }\r\n    ];\r\n\r\n    // from Dexie structure\r\n    const fieldKeys = [\r\n        \"name\",\r\n        \"phone\",\r\n        \"email\",\r\n        \"tenantName\",\r\n        \"tenantPhoneNumber\",\r\n        \"waiverCompleted\",\r\n        \"needFollowUp\",\r\n        \"buildingSurveyQuestionAnswer\"\r\n    ];\r\n\r\n    const inputElements = useRef(formLabels.map(() => createRef()));\r\n    let updateDone = true; // bad\r\n\r\n    const updateInfo = (inputValue) => {\r\n        // these match Dexie store\r\n        const offlineStorage = props.offlineStorage;\r\n        const ownerInfoValues = {\r\n            addressId: props.location.state.addressId,\r\n            formData: {}\r\n        };\r\n\r\n        if (inputValue) {\r\n            inputElements.current.forEach((input, index) => {\r\n                // this is terrible should have been part of way the content is generated so it's set in the input names\r\n                ownerInfoValues.formData[fieldKeys[index]] = input.current.value;\r\n            });\r\n        }\r\n\r\n        if (updateDone) {\r\n            updateDone = false;\r\n        \r\n            offlineStorage.transaction('rw', offlineStorage.ownerInfo, async() => {\r\n \r\n                if (\r\n                    await offlineStorage.ownerInfo.put({\r\n                        addressId: ownerInfoValues.addressId,\r\n                        formData: {\r\n                            name: ownerInfoValues.formData.name,\r\n                            phone: ownerInfoValues.formData.phone,\r\n                            email: ownerInfoValues.formData.email,\r\n                            tenantName: ownerInfoValues.formData.tenantName,\r\n                            tenantPhoneNumber: ownerInfoValues.formData.tenantPhoneNumber,\r\n                            waiverCompleted: ownerInfoValues.formData.waiverCompleted,\r\n                            needFollowUp: ownerInfoValues.formData.needFollowUp,\r\n                            buildingSurveyQuestionAnswer: ownerInfoValues.formData.buildingSurveyQuestionAnswer\r\n                        }\r\n                    }, ownerInfoValues.addressId).then(() => {\r\n                        return true;\r\n                    })\r\n                ) {\r\n                    updateDone = true;\r\n                    setOwnerInfo(ownerInfoValues);\r\n                } else {\r\n                    alert('Failed to update owner information');\r\n                }\r\n            })\r\n            .catch(e => {\r\n                alert('Failed to update owner information');\r\n                console.log('owner info', e);\r\n            });\r\n        }\r\n    }\r\n\r\n    const renderOwnerInfoFormFields = () => {\r\n        return formLabels.map((formField, index) => {\r\n            const isString = typeof formField === \"string\";\r\n            return (isString\r\n                ? <div key={index} className=\"owner-info-form__row\">\r\n                        <span>{ formField }:</span>\r\n                        <input defaultValue={ ownerInfo ? ownerInfo.formData[fieldKeys[index]] : \"\" } onBlur={ (e) => updateInfo(e.target.value) } ref={inputElements.current[index]} type=\"text\" readOnly={ props.modifyOwnerInfo ? false : true } />\r\n                    </div>\r\n                : <div className=\"owner-info-form__row group\" key={index}>\r\n                    <div className=\"owner-info-form__row white\">\r\n                        <span>{ Object.keys(formField) }:</span>\r\n                    </div>\r\n                    {\r\n                        Object.keys(formField).map((subGroup, subGroupIndex) => {\r\n                            return (\r\n                                <div key={subGroupIndex} className=\"owner-info-form__sub-row\">\r\n                                    <span>{ formField[subGroup] }</span>\r\n                                    <input defaultValue={ ownerInfo ? ownerInfo.formData[fieldKeys[index]] : \"\" } id=\"target-me\" onChange={ updateInfo } ref={inputElements.current[index]} type=\"text\" className=\"full\" readOnly={ props.modifyOwnerInfo ? false : true } />\r\n                                </div>\r\n                            );\r\n                        })\r\n                    }\r\n                </div>\r\n            );\r\n        });\r\n    }\r\n\r\n    useEffect(() => {\r\n        // TODO again this code shouldn't be here but eslint\r\n        const getOwnerInfo = async () => {\r\n            const addressId = props.location.state.addressId;\r\n            const offlineStorage = props.offlineStorage;\r\n    \r\n            if (addressId && offlineStorage) {\r\n                await offlineStorage.ownerInfo.get(addressId, (ownerInfo) => {\r\n                    setOwnerInfo(ownerInfo);\r\n                }).catch (function (err) {\r\n                    // handle this failure correctly\r\n                    alert('failed to open local storage');\r\n                });\r\n            }\r\n        }\r\n\r\n        getOwnerInfo();\r\n    }, [props, ownerInfo]);\r\n\r\n    // TODO: fix the communication between navbar save and saving here so saving isn't based on onblur\r\n    // eg. get all fields at once one time, not every time you change inputs\r\n    // useEffect(() => {\r\n    //     // get all fields\r\n    // }, [props.modifyOwnerInfo]);\r\n\r\n    return(\r\n        <div className=\"tagging-tracker__owner-info\">\r\n            <div className=\"tagging-tracker__owner-info-form\">\r\n                { renderOwnerInfoFormFields() }\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default OwnerInfo;","import axios from 'axios';\r\n\r\n/**\r\n * The sync works by a sync id, so a sync table keeps track of when a user synced\r\n * This sync id is used to find the synced rows throughout the tables which have the matching sync id\r\n * Using most recent for what to use for pulling down, then pushing up doesn't replace data\r\n * Just adds more, it is arguable that this is a waste/the same as just deleting stuff on remote side\r\n * But maybe a diff/look back is nice too in case you didn't want to delete something(address)\r\n * though currently not possible(no UI/methods)\r\n */\r\n\r\nconst getLocalAddresses = async (localStorage) => {\r\n    return new Promise(resolve => {\r\n        localStorage.addresses.toArray().then((addresses) => {\r\n            if (addresses.length) {\r\n                resolve(addresses);\r\n            } else {\r\n                resolve(false);\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            console.log('sync addresses err', err);\r\n            resolve(false);\r\n        });\r\n    });\r\n}\r\n\r\nconst getLocalTags = async (localStorage) => {\r\n    return new Promise(resolve => {\r\n        localStorage.tags.toArray().then((tags) => {\r\n            if (tags.length) {\r\n                resolve(tags);\r\n            } else {\r\n                resolve(false);\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            console.log('sync tags err', err);\r\n            resolve(false);\r\n        });\r\n    });\r\n}\r\n\r\nconst getLocalOwnerInfo = async (localStorage) => {\r\n    return new Promise(resolve => {\r\n        localStorage.ownerInfo.toArray().then((ownerInfos) => {\r\n            if (ownerInfos.length) {\r\n                resolve(ownerInfos);\r\n            } else {\r\n                resolve(false);\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            console.log('sync ownerInfo err', err);\r\n            resolve(false);\r\n        });\r\n    });\r\n}\r\n\r\nconst getTagInfo = async (localStorage) => {\r\n    return new Promise(resolve => {\r\n        localStorage.tagInfo.toArray().then((tagInfos) => {\r\n            if (tagInfos.length) {\r\n                resolve(tagInfos);\r\n            } else {\r\n                resolve(false);\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            console.log('sync tagInfos err', err);\r\n            resolve(false);\r\n        });\r\n    });\r\n}\r\n\r\nconst bundleData = async (props) => {\r\n    const localStorage = props.offlineStorage;\r\n    const bundledData = {};\r\n\r\n    return new Promise(resolve => {\r\n        // addresses\r\n        localStorage.addresses.count().then(async (count) => {\r\n            if (count > 0) {\r\n                const addresses = await getLocalAddresses(localStorage);\r\n                const tags = await getLocalTags(localStorage);\r\n                const ownerInfo = await getLocalOwnerInfo(localStorage);\r\n                const tagInfo = await getTagInfo(localStorage);\r\n                const deletedAddresses = props.deletedAddresses;\r\n\r\n                if (addresses) {\r\n                    bundledData['addresses'] = addresses;\r\n                }\r\n\r\n                if (tags) {\r\n                    bundledData['tags'] = tags;\r\n                }\r\n\r\n                if (ownerInfo) {\r\n                    bundledData['ownerInfo'] = ownerInfo;\r\n                }\r\n\r\n                if (tagInfo) {\r\n                    bundledData['tagInfo'] = tagInfo;\r\n                }\r\n\r\n                if (deletedAddresses) {\r\n                    bundledData['deletedAddresses'] = deletedAddresses;\r\n                }\r\n\r\n                resolve(bundledData);\r\n            } else {\r\n                resolve(bundledData);\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            console.timeLog('sync bundle data err', err);\r\n            resolve(false);\r\n        });\r\n    });\r\n}\r\n\r\nexport const syncUp = async (props) => {\r\n    const bundledData = await bundleData(props);\r\n\r\n    return new Promise(resolve => {\r\n        if ((Object.keys(bundledData).length === 0 || !bundledData) && !props.deletedAddresses.length) {\r\n            resolve({msg: 'No data to sync'});\r\n        } else {\r\n            // sync to remote server\r\n            const baseApiPath = window.location.href.indexOf('localhost') !== -1\r\n                ? process.env.REACT_APP_API_BASE_LOCAL\r\n                : process.env.REACT_APP_API_BASE;\r\n            const postUrl = baseApiPath + '/sync-up';\r\n            \r\n            axios.post(postUrl, {\r\n                headers: { Authorization: `Bearer ${props.token}` },\r\n                bundledData\r\n            }).then((res) => {\r\n                if (res.status === 201) {\r\n                    resolve(true);\r\n                } else {\r\n                    if (res.status === 403) {\r\n                        alert(\"Your session has expired, please login again\");\r\n                        window.location.href = \"/login\"; // flush app state\r\n                    } else {\r\n                        resolve(false);\r\n                    }\r\n                }\r\n            })\r\n            .catch((err) => {\r\n                console.log('sync err', err);\r\n                console.log(err.response);\r\n\r\n                if (typeof err.response !== \"undefined\" && typeof err.response.status !== \"undefined\" && err.response.status === 403) {\r\n                    resolve({msg: 403});\r\n                }\r\n\r\n                resolve(false);\r\n            });\r\n        }\r\n    });\r\n}","import axios from 'axios';\r\n\r\nexport const syncDown = (props) => {\r\n    return new Promise(resolve => {\r\n        const baseApiPath = window.location.href.indexOf('localhost') !== -1\r\n            ? process.env.REACT_APP_API_BASE_LOCAL\r\n            : process.env.REACT_APP_API_BASE;\r\n        const postUrl = baseApiPath + '/sync-down';\r\n\r\n        axios.post(postUrl, {\r\n            headers: { Authorization: `Bearer ${props.token}` }\r\n        }).then((res) => {\r\n            if (res.status === 200) {\r\n                resolve(res.data);\r\n            } else {\r\n                if (res.status === 403) {\r\n                    alert(\"Your session has expired, please login again\");\r\n                    window.location.href = \"/login\"; // flush app state\r\n                } else {\r\n                    resolve(false);\r\n                }\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            console.log('sync err', err);\r\n            \r\n            if (typeof err.response !== \"undefined\" && typeof err.response.status !== \"undefined\" && err.response.status === 403) {\r\n                resolve({msg: 403});\r\n            }\r\n\r\n            resolve(false);\r\n        });\r\n    });\r\n}","import { syncUp } from './syncUp';\r\nimport { syncDown } from './syncDown';\r\n\r\nconst isLocalStorageEmpty = async (props) => {\r\n    const localStorage = props.offlineStorage;\r\n\r\n    if (!localStorage) {\r\n        return;\r\n    }\r\n\r\n    // you should only have to check addresses because every other table is tied to an address\r\n    // so an address has to exist before you can add photos/owner/tag info\r\n    return new Promise(resolve => {\r\n        localStorage.addresses.count().then((count) => {\r\n            if (props.deletedAddresses.length || count > 0) {\r\n                resolve(false);\r\n            } else {\r\n                resolve(true);\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            console.log('sync addresses err', err);\r\n            resolve(true); // technically could be an error not empty\r\n        });\r\n    });\r\n}\r\n\r\nexport const syncUserData = async (props) => {\r\n    const localStorageEmpty = await isLocalStorageEmpty(props);\r\n    if (localStorageEmpty) {\r\n        // pull down\r\n        const bundledData = await syncDown(props);\r\n        if (bundledData) {\r\n            updateLocalStorageFromSync(props, bundledData);\r\n            return true;\r\n        } else {\r\n            return({msg: 'No data to sync'});\r\n        }\r\n    } else {\r\n        // push up\r\n        return await syncUp(props);\r\n    }\r\n}\r\n\r\nconst updateLocalAddresses = (props, remoteData) => {\r\n    const offlineStorage = props.offlineStorage;\r\n    return new Promise(resolve => {\r\n\r\n        if (!remoteData.addresses) {\r\n            resolve(true);\r\n        }\r\n\r\n        remoteData.addresses.forEach((addressRow, index) => {\r\n            offlineStorage.transaction('rw', offlineStorage.addresses, () => {\r\n                if (\r\n                    offlineStorage.addresses.add({\r\n                        address: addressRow.address,\r\n                        lat: addressRow.lat,\r\n                        lng: addressRow.lng,\r\n                        created: addressRow.created,\r\n                        updated: addressRow.updated\r\n                    }).then((insertedId) => {\r\n                        return true;\r\n                    })\r\n                ) {\r\n                    if (index === remoteData.addresses.length - 1) {\r\n                        resolve(true);\r\n                    }\r\n                } else {\r\n                    resolve(false);\r\n                }\r\n            })\r\n            .catch(e => {\r\n                resolve(false);\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nconst updateLocalTags = (props, remoteData) => {\r\n    const offlineStorage = props.offlineStorage;\r\n    return new Promise(resolve => {\r\n        if (!remoteData.tags) {\r\n            resolve(true);\r\n        }\r\n\r\n        remoteData.tags.forEach((tagRow, index) => {\r\n            offlineStorage.transaction('rw', offlineStorage.tags, () => {\r\n                const tagMeta = JSON.parse(tagRow.meta);\r\n                if (\r\n                    offlineStorage.tags.add({\r\n                        addressId: tagRow.address_id,\r\n                        fileName: tagMeta.name,\r\n                        thumbnail_src: tagRow.thumbnail_src,\r\n                        meta: tagMeta\r\n                    }).then((insertedId) => {\r\n                        return true;\r\n                    })\r\n                ) {\r\n                    if (index === remoteData.tags.length - 1) {\r\n                        resolve(true);\r\n                    }\r\n                } else {\r\n                    resolve(false);\r\n                }\r\n            })\r\n            .catch(e => {\r\n                resolve(false);\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nconst updateLocalOwnerInfo = (props, remoteData) => {\r\n    const offlineStorage = props.offlineStorage;\r\n    return new Promise(resolve => {\r\n        if (!remoteData.ownerInfo) {\r\n            resolve(true);\r\n        }\r\n\r\n        remoteData.ownerInfo.forEach((ownerInfoRow, index) => {\r\n            offlineStorage.transaction('rw', offlineStorage.ownerInfo, () => {\r\n                if (\r\n                    offlineStorage.ownerInfo.add({\r\n                        addressId: ownerInfoRow.address_id,\r\n                        formData: JSON.parse(ownerInfoRow.form_data)\r\n                    }).then((insertedId) => {\r\n                        return true;\r\n                    })\r\n                ) {\r\n                    if (index === remoteData.ownerInfo.length - 1) {\r\n                        resolve(true);\r\n                    }\r\n                } else {\r\n                    resolve(false);\r\n                }\r\n            })\r\n            .catch(e => {\r\n                resolve(false);\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nconst updateLocalTagInfo = (props, remoteData) => {\r\n    const offlineStorage = props.offlineStorage;\r\n    return new Promise(resolve => {\r\n        if (!remoteData.tagInfo) {\r\n            resolve(true);\r\n        }\r\n\r\n        remoteData.tagInfo.forEach((tagInfoRow, index) => {\r\n            offlineStorage.transaction('rw', offlineStorage.tagInfo, () => {\r\n                if (\r\n                    offlineStorage.tagInfo.add({\r\n                        addressId: tagInfoRow.address_id,\r\n                        formData: JSON.parse(tagInfoRow.form_data)\r\n                    }).then((insertedId) => {\r\n                        return true;\r\n                    })\r\n                ) {\r\n                    if (index === remoteData.tagInfo.length - 1) {\r\n                        resolve(true);\r\n                    }\r\n                } else {\r\n                    resolve(false);\r\n                }\r\n            })\r\n            .catch(e => {\r\n                resolve(false);\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nexport const updateLocalStorageFromSync = async (props, remoteData) => {\r\n    let noUpdateErr = true;\r\n    noUpdateErr = await updateLocalAddresses(props, remoteData); // these if successful/not empty return true\r\n    noUpdateErr = await updateLocalTags(props, remoteData);\r\n    noUpdateErr = await updateLocalOwnerInfo(props, remoteData);\r\n    noUpdateErr = await updateLocalTagInfo(props, remoteData);\r\n\r\n    if (noUpdateErr) {\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n}\r\n\r\n// TODO: actually this probably shouldn't be here\r\n\r\n// this will only delete Dexie for now, need to figure out about caching static files/service workers\r\n// primarily this is for sync so you pull down after logging out\r\nexport const deleteLocalData = (offlineStorage) => {\r\n    return new Promise(resolve => {\r\n        offlineStorage.delete().then(() => {\r\n            resolve(true);\r\n        })\r\n        .catch((err) => {\r\n            resolve(false);\r\n        })\r\n    });\r\n}","// this is trying to detect browser by user agent not really great\r\n// but this particular app has a fixed, bottom navbar which is problematic with Safari\r\n// since the Safari menu bar overlaps the browser\r\n// the Safari menu bar height changes though so the magic number 44px is a best guess pulled from some site\r\n// initially I saw that when you scroll down the Safari bottom menu goes away/comes back scrolling up\r\n// but it seems if you don't have overflow/shorter in height then the bottom navbar will be ontop of the Safari bottom menu\r\n// I guess Mac has this issue too? That's what I see in Sauce Labs simulator\r\nexport const checkIOS = () => {\r\n    const iOS = /(iPhone|iPod|iPhone Simulator|iPod Simulator|iPad|iPad Simulator|Macintosh)/g.test(navigator.userAgent);\r\n\r\n    if (iOS) {\r\n        document.querySelector('.tagging-tracker__bottom-navbar').classList.add('iOS');\r\n    }\r\n}\r\n\r\nexport const resizeAdjustHeight = () => {\r\n    document.querySelector('.tagging-tracker').style.height = window.innerHeight + \"px\";\r\n}\r\n\r\n// TODO this is not great magic number is from the bottom navbar\r\n// mainly it's bad due to that JS render flash jank\r\nexport const addPathClassToBody = (props) => {\r\n    const curPath = props.location.pathname;\r\n\r\n    if (curPath !== \"/addresses\" || curPath !== \"/\") {\r\n        document.querySelector('.tagging-tracker__body').style.maxHeight = (window.innerHeight - 52) + \"px\";\r\n    }\r\n}","export const deleteAddress = (props, addressObj, finishedDeletingAddress) => {\r\n    const db = props.offlineStorage;\r\n    const addressId = addressObj.addressId;\r\n    let backupDelFailTimer;\r\n\r\n    const doneDeleting = () => {\r\n        clearTimeout(backupDelFailTimer);\r\n        alert('Address deleted! Redirecting...');\r\n        finishedDeletingAddress(addressObj);\r\n    }\r\n\r\n    // these are asynchronous events so when one finishes it calls the next\r\n    const deleteAddressOwnerInfo = (dbOpened) => {\r\n        const ownerInfo = dbOpened.ownerInfo.where(\"addressId\").equals(addressId);\r\n        ownerInfo.count()\r\n            .then((count) => {\r\n                if (count) {\r\n                    ownerInfo.delete()\r\n                        .then(() => {\r\n                            console.log('owner info deleted');\r\n                            deleteAddressTagInfo(dbOpened);\r\n                        })\r\n                        .catch((err) => {\r\n                            alert('Failed to delete owner info');\r\n                            console.log('delete owner info', err);\r\n                        });\r\n                } else {\r\n                    deleteAddressTagInfo(dbOpened); // next step\r\n                }\r\n            })\r\n            .catch((err) => {\r\n                alert('Failed to delete owner info');\r\n                console.log('delete owner info', err);\r\n            });\r\n    }\r\n\r\n    const deleteAddressTagInfo = (dbOpened) => {\r\n        const tagInfo = dbOpened.tagInfo.where(\"addressId\").equals(addressId);\r\n        tagInfo.count()\r\n            .then((count) => {\r\n                if (count) {\r\n                    tagInfo.delete()\r\n                        .then(() => {\r\n                            console.log('tag info deleted');\r\n                            deleteAddressTags(dbOpened);\r\n                        })\r\n                        .catch((err) => {\r\n                            alert('Failed to delete tag info');\r\n                            console.log('delete tags', err);\r\n                        });\r\n                } else {\r\n                    deleteAddressTags(dbOpened);\r\n                }\r\n            })\r\n            .catch((err) => {\r\n                alert('Failed to delete tag info');\r\n                console.log('delete tag info', err);\r\n            });\r\n    }\r\n\r\n    const deleteAddressTags = (dbOpened) => {\r\n        const tags = dbOpened.tags.where(\"addressId\").equals(addressId);\r\n        tags.count()\r\n            .then((count) => {\r\n                if (count) {\r\n                    tags.delete()\r\n                        .then(() => {\r\n                            console.log('tags deleted');\r\n                            deleteAddressRow(dbOpened);\r\n                        })\r\n                        .catch((err) => {\r\n                            alert('Failed to delete tags');\r\n                            console.log('delete tags', err);\r\n                        });\r\n                } else {\r\n                    deleteAddressRow(dbOpened);\r\n                }\r\n            })\r\n            .catch((err) => {\r\n                alert('Failed to delete tags');\r\n                console.log('delete tags', err);\r\n            });\r\n    }\r\n\r\n    const deleteAddressRow = (dbOpened) => {\r\n        const addresses = dbOpened.addresses.where(\"id\").equals(addressId);\r\n        addresses.count()\r\n            .then((count) => {\r\n                if (count) {\r\n                    addresses.delete() // should only be one\r\n                        .then(() => {\r\n                            console.log('address deleted');\r\n                            doneDeleting();\r\n                        })\r\n                        .catch((err) => {\r\n                            alert('Failed to delete address');\r\n                            console.log('delete address', err);\r\n                        });\r\n                } else {\r\n                    doneDeleting();\r\n                }\r\n            })\r\n            .catch((err) => {\r\n                alert('Failed to delete address');\r\n                console.log('delete address', err);\r\n            });\r\n    }\r\n\r\n    if (db) {\r\n        // this is not ideal with how it handles partial failures\r\n        db.open().then(function (dbOpened) {\r\n            deleteAddressOwnerInfo(dbOpened);\r\n\r\n            // backup timer if all fails\r\n            backupDelFailTimer = setTimeout(() => {\r\n                alert('Failed to delete address or taking longer than usual'); // what\r\n                finishedDeletingAddress();\r\n            }, 60000); // 1 min long\r\n        }).catch (function (err) {\r\n            // handle this failure correctly\r\n            alert('failed to open local storage', err);\r\n            finishedDeletingAddress();\r\n        });\r\n    } else {\r\n        alert('Failed to delete address');\r\n        finishedDeletingAddress();\r\n    }\r\n}","import React, { useRef, useEffect, useState } from 'react';\r\nimport { Link, useHistory } from 'react-router-dom';\r\nimport './BottomNavbar.scss';\r\n\r\nimport syncIcon from './../../assets/icons/svgs/upload.svg';\r\nimport logoutIcon from './../../assets/icons/svgs/switch.svg';\r\nimport property from './../../assets/icons/svgs/property.svg';\r\nimport textDocument from './../../assets/icons/svgs/text-document.svg';\r\nimport addSquare from './../../assets/icons/svgs/add-square.svg';\r\nimport deleteIcon from './../../assets/icons/svgs/delete.svg';\r\nimport ajaxLoaderGray from './../../assets/gifs/ajax-loader--gray.gif';\r\nimport ajaxLoaderBlue from './../../assets/gifs/ajax-loader--blue.gif';\r\nimport { syncUserData, deleteLocalData } from '../../utils/sync/sync';\r\nimport { checkIOS, resizeAdjustHeight, addPathClassToBody } from '../../utils/misc';\r\nimport { deleteAddress } from '../../utils/delete';\r\n\r\nconst BottomNavbar = (props) => {\r\n    const syncBtn = useRef(null);\r\n    const logoutBtn = useRef(null);\r\n    const cameraBtn = useRef(null);\r\n    const uploadBtn = useRef(null);\r\n    const history = useHistory();\r\n    const [deletingAddress, setDeletingAddress] = useState(false);\r\n\r\n    const logout = async () => {\r\n        props.updateLoggingOut(true);\r\n        const localStorageCleared = await deleteLocalData(props.offlineStorage);\r\n        if (!localStorageCleared) {\r\n            alert('failed to clear local data');\r\n        }\r\n        window.location.href = \"/\"; // token is wiped out as it's set by state not in storage\r\n    }\r\n\r\n    const saveToDevice = () => {\r\n        props.saveToDevice();\r\n    }\r\n\r\n    // this probably shouldn't be here but just an initializer\r\n    const sync = async () => {\r\n        if (!props.appOnline) { // shouldn't be needed disabled buttons\r\n            alert('Unable to sync, you are offline');\r\n            return;\r\n        }\r\n\r\n        if (!props.token) {\r\n            alert('Please login to sync');\r\n            history.push(\"/login\");\r\n            return;\r\n        }\r\n\r\n        if (!props.syncApp) {\r\n            props.setSyncApp(true);\r\n            const synced = await syncUserData(props);\r\n\r\n            if (Object.keys(synced).length) {\r\n                if (synced.msg !== \"undefined\") {\r\n                    if (synced.msg === 403) {\r\n                        alert('You have been logged out, please login to sync');\r\n                    } else {\r\n                        alert(synced.msg);\r\n                    }\r\n                }\r\n            } else if (synced) {\r\n                // synced\r\n            } else {\r\n                alert('Failed to sync');\r\n            }\r\n\r\n            props.setSyncApp(false);\r\n        }\r\n    }\r\n\r\n    const uploadImages = () => {\r\n        if (!props.appOnline) {\r\n            alert('Unable to upload, you are offline');\r\n            return;\r\n        }\r\n\r\n        if (!props.token) {\r\n            const loginDecision = window.confirm('You need to be logged in to upload. Login or use save to device to keep selected files. Pressing OK will redirect you to the login page.');\r\n            if (loginDecision) {\r\n                history.push(\"/login\");\r\n            }\r\n            return;\r\n        }\r\n\r\n        props.triggerFileUpload(true);\r\n    }\r\n\r\n    // this is for Safari, since the prop method that is propagated up into AddTag\r\n    // doesn't work in Safari \"not a direct action by user\" file input wasn't working\r\n    const directCameraClick = () => {\r\n        document.getElementById('add-tag-file-input').click();\r\n    }\r\n\r\n    // this function is called after the delete process is done\r\n    const finishedDeletingAddress = (addressObj) => {\r\n        // finished deleting, go back to main addresses view\r\n        setDeletingAddress(false);\r\n        if (Object.keys(addressObj).length) {\r\n            const tmpArr = props.deletedAddresses;\r\n            tmpArr.push(addressObj.address); // the primary \"key\" is the address string\r\n            props.setDeletedAddresses(tmpArr);\r\n        }\r\n        history.push(\"/addresses\");\r\n    }\r\n\r\n    const deleteAddressBtnCallback = (addressObj) => {\r\n        // bad naming convention\r\n        const shouldDeleteAddress = window.confirm(\"Delete \" + addressObj.address + \" ?\");\r\n        if (shouldDeleteAddress) {\r\n            setDeletingAddress(true);\r\n            deleteAddress(props, addressObj, finishedDeletingAddress);\r\n        }\r\n    }\r\n\r\n    const renderBottomNavbar = (routeLocation) => {\r\n        const address = props.location.state;\r\n        const routePath =  props.baseDir ? routeLocation.pathname.replace(props.baseDir + \"/\", \"\") : routeLocation.pathname;\r\n\r\n        switch(routePath) {\r\n            case \"/\":\r\n            case \"/addresses\":\r\n                return <>\r\n                    <button onClick= { sync } ref={ syncBtn } className=\"bottom-navbar__btn half sync\"\r\n                    type=\"button\" disabled={ props.appOnline ? false : true }>\r\n                        {props.syncApp\r\n                            ? <>\r\n                                <span>Syncing...</span>\r\n                                <img src={ ajaxLoaderGray } alt=\"syncing spinner\" />\r\n                            </>\r\n                            : <>\r\n                                <img src={ syncIcon } alt=\"sync button icon\" />\r\n                                <span>Sync</span>\r\n                            </>\r\n                        }\r\n                    </button>\r\n                    <button ref={ logoutBtn } onClick={ logout } className=\"bottom-navbar__btn half\" type=\"button\">\r\n                        {props.loggingOut\r\n                            ? <>\r\n                                <span>Logging out...</span>\r\n                                <img src={ ajaxLoaderGray } alt=\"logging out spinner\" />\r\n                            </>\r\n                            : <>\r\n                                <img src={ logoutIcon } alt=\"logout button icon\" />\r\n                                <span>Logout</span>\r\n                            </>\r\n                        }\r\n                    </button>\r\n                </>\r\n            case \"/view-address\":\r\n            case \"/edit-tags\":\r\n                return <>\r\n                    <button\r\n                        onClick={ () => deleteAddressBtnCallback(address) }\r\n                        className=\"bottom-navbar__btn fourth\"\r\n                        disabled={ deletingAddress ? true : false }>\r\n                        {deletingAddress\r\n                            ? <>\r\n                                <span>Deleting...</span>\r\n                                <img src={ ajaxLoaderGray } alt=\"deleting address spinner\" />\r\n                            </>\r\n                            : <>\r\n                                <img src={ deleteIcon } alt=\"home owner button icon\" />\r\n                                <span>Delete</span>\r\n                            </>\r\n                        }\r\n                    </button>\r\n                    <Link\r\n                        to={{ pathname: \"/owner-info\", state: {\r\n                                address: address.address,\r\n                                addressId: address.addressId // used for lookup\r\n                        }}}\r\n                        className=\"bottom-navbar__btn fourth\">\r\n                        <img src={ property } alt=\"home owner button icon\" />\r\n                        <span>Owner Info</span>\r\n                    </Link>\r\n                    <Link\r\n                        to={{ pathname: \"/tag-info\", state: {\r\n                                address: address.address,\r\n                                addressId: address.addressId // used for lookup\r\n                        }}}\r\n                        className=\"bottom-navbar__btn fourth\">\r\n                        <img src={ textDocument } alt=\"tag info button icon\" />\r\n                        <span>Tag Info</span>\r\n                    </Link>\r\n                    <Link\r\n                        to={{ pathname: \"/add-tag\", state: {\r\n                            address: address.address,\r\n                            addressId: address.addressId // used for lookup\r\n                        }}}\r\n                        className=\"bottom-navbar__btn fourth\">\r\n                        <img src={ addSquare } alt=\"add tag icon\" />\r\n                        <span>Add Tag</span>\r\n                    </Link>\r\n                </>\r\n            case \"/add-tag\":\r\n                return <>\r\n                    <button ref={ cameraBtn } onClick={ directCameraClick } className=\"bottom-navbar__btn quarter caps-blue border small-font\" type=\"button\">\r\n                        <span>Use Camera</span>\r\n                    </button>\r\n                    <button ref={ uploadBtn } onClick={ uploadImages } className=\"bottom-navbar__btn quarter caps-blue border small-font\" type=\"button\" disabled={ props.loadedPhotos.length ? false : true }>\r\n                        {props.uploadInProgress\r\n                            ? <>\r\n                                <span>Uploading...</span>\r\n                                <img src={ ajaxLoaderBlue } alt=\"uploading spinner\" />\r\n                            </>\r\n                            : <>\r\n                                <span>Upload</span>\r\n                            </>\r\n                        }\r\n                    </button>\r\n                    <button onClick={ saveToDevice }\r\n                        className=\"bottom-navbar__btn quarter caps-blue border small-font\"\r\n                        type=\"button\"\r\n                        disabled={ props.savingToDevice ? true : false }>\r\n                            {props.savingToDevice\r\n                                ? <>\r\n                                    <span>Saving...</span>\r\n                                    <img src={ ajaxLoaderBlue } alt=\"saving spinner\" />\r\n                                </>\r\n                                : <>\r\n                                    <span>Save To Device</span>\r\n                                </>\r\n                            }\r\n                    </button>\r\n                    <Link\r\n                        to={{ pathname: \"/view-address\", state: {\r\n                            address: address.address,\r\n                            addressId: address.addressId // used for lookup\r\n                        }}}\r\n                        className=\"bottom-navbar__btn quarter caps-blue small-font\">\r\n                            <span>Cancel</span>\r\n                    </Link>\r\n                </>\r\n            case \"/tag-info\":\r\n            case \"/owner-info\":\r\n                const tagPath = props.location.pathname === \"/tag-info\";\r\n\r\n                return <>\r\n                    <Link\r\n                        to={{ pathname: \"/owner-info\", state: {\r\n                                address: address.address,\r\n                                addressId: address.addressId // used for lookup\r\n                        }}}\r\n                        className={\"bottom-navbar__btn toggled \" + (!tagPath ? \"active\" : \"\") }>\r\n                            <img src={ property } alt=\"home owner button icon\" />\r\n                            <span>Owner Info</span>\r\n                    </Link>\r\n                    <Link\r\n                        to={{ pathname: \"/tag-info\", state: {\r\n                                address: address.address,\r\n                                addressId: address.addressId // used for lookup\r\n                        }}}\r\n                        className={\"bottom-navbar__btn toggled \" + (tagPath ? \"active\" : \"\") }>\r\n                            <img src={ textDocument } alt=\"tag info button icon\" />\r\n                            <span>Tag Info</span>\r\n                    </Link>\r\n                </>\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    const getBottomNavbarClasses = () => {\r\n        const floatingBtnPaths = [\r\n            \"/owner-info\",\r\n            \"/tag-info\"\r\n        ];\r\n\r\n        const floatingBtns = floatingBtnPaths.indexOf(props.location.pathname) !== -1;\r\n\r\n        if (floatingBtns) {\r\n            return \"tagging-tracker__bottom-navbar floating-btns\";\r\n        }\r\n\r\n        return \"tagging-tracker__bottom-navbar\";\r\n    }\r\n\r\n    useEffect(() => {\r\n\t\t// this modifies the layout/some css classes/styles based on if the user is using iOS/Safari\r\n        window.addEventListener('resize', resizeAdjustHeight);\r\n        checkIOS();\r\n        addPathClassToBody(props);\r\n        window.removeEventListener('resize', resizeAdjustHeight);\r\n    });\r\n\r\n    return(\r\n        <div className={ getBottomNavbarClasses() }>\r\n            { renderBottomNavbar(props.location) }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default BottomNavbar;","import React from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport './Page404.scss';\r\n\r\nconst Page404 = (props) => {\r\n    return (\r\n        <div className=\"tagging-tracker__page-404\">\r\n            <h2>You've entered an invalid path</h2>\r\n            <p>Try the page(s) below to return to the app</p>\r\n            <Link to=\"/\">Login</Link>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Page404;","import React, { useRef, useState, useEffect } from 'react';\r\nimport './AddTag.scss';\r\nimport BottomNavbar from './../../components/bottom-navbar/BottomNavbar';\r\nimport axios from 'axios';\r\nimport { getTimeStamp } from './../../utils/date';\r\n\r\n/**\r\n * Brief explanation how this works it's kind of confusing since everything is a callback of a callback\r\n * The bottomNavbar starts it off by setting loadCamera to true\r\n * Then that clicks on fileInput which if a device has a camera prompts to open the camera or show file upload(pc)\r\n * Then when the fileInput changes, cameraCallback is called and the previewPhoto function is called\r\n * That actually renders it on page, then when the rendered image load, it has a callback to update image meta eg. width/height\r\n * which can only be taken from a loaded <img />\r\n * I'm going to resize the photo with canvas for the thumbnail and potentially save storage by capping files\r\n * @param {*} props \r\n */\r\nconst AddTag = (props) => {\r\n    const fileInput = useRef(null);\r\n    const [loadCamera, triggerLoadCamera] = useState(false);\r\n    const [fileUpload, triggerFileUpload] = useState(false);\r\n    const [loadedPhotos, setLoadedPhotos] = useState([]);\r\n    const [savingToDevice, setSavingToDevice] = useState(false);\r\n    const [uploadInProgress, setUploadInProgress] = useState(false);\r\n\r\n    // https://hacks.mozilla.org/2011/01/how-to-develop-a-html5-image-uploader/\r\n    const scaleImage = (resolve, img) => {\r\n        // figure out canvas height based on desired resize dimensions\r\n        const imgAspectRatio = (img.width / img.height >= 1) ? 'landscape' : 'portrait';\r\n        let newImageWidth = 300;\r\n        let newImageHeight = 300;\r\n\r\n        if (imgAspectRatio === 'landscape') {\r\n            const newImageWidth = 300;\r\n            newImageHeight = ((newImageWidth * img.height) / img.width); // round?\r\n        } else {\r\n            const newImageHeight = 300;\r\n            newImageWidth = ((newImageHeight * img.width) / img.height); // round?\r\n        }\r\n        \r\n        const canvas = document.createElement(\"canvas\");\r\n        canvas.id = \"resize-canvas\";\r\n        const ctx = canvas.getContext(\"2d\");\r\n        canvas.width = newImageWidth;\r\n        canvas.height = newImageHeight;\r\n        ctx.drawImage(img, 0, 0, newImageWidth, newImageHeight);\r\n        resolve(canvas.toDataURL(\"image/png\"));\r\n        // fail case?\r\n    }\r\n\r\n    const createThumbnailSrc = (src) => {\r\n        return new Promise((resolve, reject) => {\r\n            const img = new Image();\r\n            img.src = src;\r\n\r\n            img.onload = () => {\r\n                if (img.width <= 300) {\r\n                    resolve(src);\r\n                }\r\n                scaleImage(resolve, img);\r\n            };\r\n\r\n            img.onerror = (err) => {\r\n                reject(err);\r\n            }\r\n        });\r\n    }\r\n\r\n    const saveToDevice = async () => {\r\n        setSavingToDevice(true);\r\n\r\n        const offlineStorage = props.offlineStorage;\r\n        const address = props.location.state;     \r\n\r\n        // not going to add duplicate logic here because you can delete them somewhere else\r\n        // the loaded photos are deleted after upload so duplicate issue doesn't happen unless the file is selected again\r\n        for (let i = 0; i < loadedPhotos.length; i++) {\r\n            const loadedPhoto = loadedPhotos[i];\r\n            const index = i;\r\n            const thumbnailSrc = await createThumbnailSrc(loadedPhoto.src);\r\n            const oldCanvas = document.getElementById('resize-canvas');\r\n            if (oldCanvas) {\r\n                oldCanvas.remove();\r\n            }\r\n\r\n            offlineStorage.transaction('rw', offlineStorage.tags, async() => {\r\n                if (\r\n                    await offlineStorage.tags.add({\r\n                        addressId: address.addressId,\r\n                        fileName: loadedPhoto.meta.name,\r\n                        src: loadedPhoto.src,\r\n                        thumbnail_src: thumbnailSrc,\r\n                        meta: loadedPhoto.meta,\r\n                        timestamp: getTimeStamp()\r\n                    }).then((insertedId) => {\r\n                        return true;\r\n                    })\r\n                ) {\r\n                    if (index === loadedPhotos.length - 1) {\r\n                        alert('Photos saved');\r\n                        setLoadedPhotos([]);\r\n                        setSavingToDevice(false);\r\n                    }\r\n                } else {\r\n                    alert('Failed to save photos to device');\r\n                }\r\n            })\r\n            .catch(e => {\r\n                console.log('failed to save photos', e);\r\n                alert('Failed to save photos to device');\r\n            });\r\n        }\r\n    }\r\n\r\n    const uploadImages = () => {\r\n        const baseApiPath = window.location.href.indexOf('localhost') !== -1\r\n            ? process.env.REACT_APP_API_BASE_LOCAL\r\n            : process.env.REACT_APP_API_BASE;\r\n        const postUrl = baseApiPath + '/upload-tag';\r\n        \r\n        axios.post(postUrl, {\r\n            headers: { Authorization: `Bearer ${props.token}` },\r\n            images: loadedPhotos\r\n        }).then((res) => {\r\n            if (res.status === 200) {\r\n                saveToDevice(); // because don't want to bridge remote sync from upload here\r\n            } else {\r\n                if (res.status === 403) {\r\n                    alert(\"Your session has expired, please login again\");\r\n                    window.location.href = \"/login\"; // flush app state\r\n                } else {\r\n                    alert('Failed to upload');\r\n                }\r\n            }\r\n            triggerFileUpload(false);\r\n            setUploadInProgress(false);\r\n        })\r\n        .catch((err) => {\r\n            if (typeof err.response !== \"undefined\" && typeof err.response.status !== \"undefined\" && err.response.status === 403) {\r\n                alert('You have been logged out, please log back in to upload.');\r\n                window.location.href = \"/login\"; // flush app state\r\n            } else {\r\n                console.log('upload err', err);\r\n                triggerFileUpload(false);\r\n                setUploadInProgress(false);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Step 2: when file input changes, check if file/photo selected\r\n    const cameraCallback = (fileInput) => {\r\n        if (fileInput.files.length) {\r\n\t\t\tpreviewPhoto(fileInput);\r\n\t\t} else {\r\n            alert('No image selected');\r\n        }\r\n    }\r\n\r\n    // Step 3: read the photo and get src plus other data like size\r\n    const previewPhoto = (fileInput) => {\r\n        const reader = new FileReader();\r\n        const file = fileInput.files[0]; // I guess multi-select upload is special, I tried it doesn't work with current code\r\n\r\n        reader.onload = function (e) {\r\n            setLoadedPhotos(loadedPhotos.concat({\r\n                addressId: props.location.state.addressId,\r\n                fileName: file.name,\r\n                src: e.target.result,\r\n                thumbanil_src: \"\",\r\n                meta: {\r\n                    \"name\": file.name,\r\n                    \"size\": file.size\r\n                }\r\n            }));\r\n        }\r\n\r\n        reader.readAsDataURL(file);\r\n    }\r\n\r\n    // Step 4: this runs anytime the page loads but when photos are available they will get rendered as <img />\r\n    const renderPhotoPreviews = () => {\r\n        return loadedPhotos.map((loadedPhoto, index) => {\r\n            return (\r\n                <div style={{\r\n                    backgroundImage: 'url(' + loadedPhoto.src + ')'\r\n                }} key={index} className=\"tagging-tracker__address-tag\" >\r\n                    <img alt={ loadedPhoto.meta.name } src={loadedPhoto.src} onLoad={ (e) => setLoadedImageMeta(e.target, index) } />\r\n                </div>\r\n            )\r\n        })\r\n    }\r\n\r\n    // Step 5: this is a callback when the new <img />'s load to get additional meta\r\n    // the meta's collected in different stages, the file itself(previewPhoto) has the name, size\r\n    // the image that loads has the width/height\r\n    const setLoadedImageMeta = (loadedImage, loopIndex) => {\r\n        const loadedPhotosClone = loadedPhotos;\r\n\t\tloadedPhotos.filter((loadedPhoto, index) => { // eslint-disable-line\r\n            if (loopIndex === index && typeof loadedPhotos[index].meta.width === \"undefined\") {\r\n                loadedPhotosClone[index].meta['width'] = loadedImage.width;\r\n                loadedPhotosClone[index].meta['height'] = loadedImage.height;\r\n                setLoadedPhotos(loadedPhotosClone);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Step 1: Click on file input when clicking on Use Camera button\r\n    useEffect(() => {\r\n        if (loadCamera) {\r\n            // handled in BottomNavbar directly\r\n        } else {\r\n            triggerLoadCamera(false);\r\n        }\r\n    }, [loadCamera]);\r\n\r\n    // callback to toggle/make Use Camera useable again\r\n    useEffect(() => {\r\n        triggerLoadCamera(false);\r\n    }, [loadedPhotos]);\r\n\r\n    useEffect(() => {\r\n        if (fileUpload && !uploadInProgress) {\r\n            setUploadInProgress(true);\r\n            uploadImages();\r\n        }\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [fileUpload, uploadInProgress]); // TODO ugly fix above, eslint disable but not trying to put the upload code in here\r\n\r\n    // TODO this is not staying eg. ugly flash\r\n    useEffect(() => {\r\n        props.setBodyClass(\"tagging-tracker__body increase-height\");\r\n    }, [props]);\r\n\r\n    return (\r\n        <>\r\n            <div className=\"tagging-tracker__add-tag move-bottom-navbar-down\">\r\n                <input type=\"file\" ref={fileInput} name=\"image\" onChange={ () => { cameraCallback(fileInput.current) } } id=\"add-tag-file-input\" />\r\n                { renderPhotoPreviews() }\r\n            </div>\r\n            <BottomNavbar\r\n                {...props}\r\n                triggerLoadCamera={triggerLoadCamera}\r\n                loadCamera={loadCamera}\r\n                triggerFileUpload={triggerFileUpload}\r\n                fileUpload={fileUpload}\r\n                saveToDevice={saveToDevice}\r\n                savingToDevice={savingToDevice}\r\n                uploadInProgress={uploadInProgress}\r\n                setUploadInProgress={setUploadInProgress}\r\n                loadedPhotos={loadedPhotos}\r\n                appOnline={props.appOnline}\r\n                token={props.token}\r\n            />\r\n        </>\r\n    );\r\n}\r\n\r\nexport default AddTag;","import React, { useState, useEffect } from 'react';\r\nimport { BrowserRouter as Router, Route, Switch, Redirect } from 'react-router-dom';\r\nimport './App.scss';\r\nimport Dexie from 'dexie';\r\nimport axios from 'axios';\r\n\r\n// misc utils\r\nimport { getDateTime } from './utils/date';\r\n\r\n// components and pages\r\nimport Navbar from './components/navbar/Navbar';\r\nimport Login from './components/login/Login';\r\nimport Addresses from './components/addresses/Addresses';\r\nimport ViewAddress from './components/view-address/ViewAddress';\r\nimport TagInfo from './components/tag-info/TagInfo';\r\nimport OwnerInfo from './components/owner-info/OwnerInfo';\r\nimport BottomNavbar from './components/bottom-navbar/BottomNavbar';\r\nimport Page404 from './pages/page404/Page404';\r\nimport AddTag from './components/add-tag/AddTag';\r\nimport DeleteTag from './components/edit-tags/EditTags';\r\n\r\nconst App = () => {\r\n\tconst [token, setToken] = useState(\"\");\r\n\tconst [searchedAddress, updateSearchedAddress] = useState(\"\");\r\n\tconst [showAddressModal, setShowAddressModal] = useState(false);\r\n\tconst [appOnline, setAppOnline] = useState(true);\r\n\tconst [offlineStorage, setOfflineStorage] = useState(null);\r\n\tconst [modifyOwnerInfo, toggleModifyOwnerInfo] = useState(false);\r\n\tconst [modifyTagInfo, toggleModifyTagInfo] = useState(false);\r\n\tconst [bodyClass, setBodyClass] = useState(\"tagging-tracker__body\"); // this will be removed when UI is updated, it's for AddTag BottomNavbar\r\n\tconst [syncApp, setSyncApp] = useState(false);\r\n\tconst [loggingOut, updateLoggingOut] = useState(false);\r\n\tconst [deletedAddresses, setDeletedAddresses] = useState([]); // I only later realized you can have a whole state object vs individual lines like this\r\n\r\n\t// this is for the github pages deployment for the subdirectory\r\n\t// this also gets passed down into navbar.js and bottomNavbar.js\r\n\t// if using a custom domain vs. github.pages.io/sub-directory/app, this is not needed/default to empty string\r\n\t// const baseName = window.location.href.indexOf('localhost:') !== -1 ? \"\" : \"tagging-tracker-pwa\"; // package.json homepage should match this false value\r\n\tconst baseName = \"\"; // package.json homepage should be /\r\n\r\n\tconst searchAddress = (searchStr) => {\r\n\t\tupdateSearchedAddress(searchStr);\r\n\t}\r\n\r\n\tconst toggleAddressModal = (show) => {\r\n\t\tsetShowAddressModal(show);\r\n\t}\r\n\r\n\tconst clearSearchedAddress = () => {\r\n\t\tupdateSearchedAddress(\"\");\r\n\t}\r\n\r\n\tconst updateToken = (token) => {\r\n\t\tsetToken(token);\r\n\t}\r\n\r\n\tconst updateAppOnlineState = (event) => {\r\n\t\tconst online = event.type === \"online\";\r\n\t\tif (appOnline !== online) {\r\n\t\t\tsetAppOnline(!appOnline);\r\n\t\t}\r\n\t}\r\n\r\n\tconst checkOnlineStatus = () => {\r\n\t\twindow.addEventListener('online', updateAppOnlineState);\r\n\t\twindow.addEventListener('offline', updateAppOnlineState);\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener('online', updateAppOnlineState);\r\n\t\t\twindow.removeEventListener('offline', updateAppOnlineState);\r\n\t\t};\r\n\t}\r\n\r\n\t// tags: timestamp is a random, should be unique value for deletion locally\r\n\t// it is not used for syncing or remote upload or anything like that\r\n\t// the reason is it is not straight forward to get an id from Dexie to delete with\r\n\t// I think because of how the schema is structured eg. its key is based on addresses ++id\r\n\tconst setupOfflineStorage = () => {\r\n\t\tconst db = new Dexie(\"LocalImageDatabase\");\r\n\t\tdb.version(1).stores({\r\n\t\t\taddresses: \"++id,address,lat,lng,created,updated\",\r\n\t\t\ttags: \"++,fileName,addressId,meta,timestamp\",\r\n\t\t\townerInfo: \"++,addressId,formData\",\r\n\t\t\ttagInfo: \"++,addressId,formData\"\r\n\t\t});\r\n\t\tsetOfflineStorage(db);\r\n\t};\r\n\r\n\t// this is for making sure the remote side is not empty eg. in the middle of a build\r\n\t// this does throw an Uncaught promise error, haven't figured out why but it doesn't break code\r\n\t// does its job of preventing overwriting client code with nothing\r\n\tconst checkRemoteNotEmpty = () => {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst frontEndBasePath = window.location.href.indexOf('localhost') === -1\r\n\t\t\t\t? process.env.REACT_APP_BASE\r\n\t\t\t\t: false;\r\n\r\n\t\t\tif (!frontEndBasePath) {\r\n\t\t\t\tresolve(false);\r\n\t\t\t} else {\r\n\t\t\t\taxios.get(frontEndBasePath + '/?' + Date.now()) // this is just \"cache busting\" as the PWA caches requests\r\n\t\t\t\t\t.then((response) => {\r\n\t\t\t\t\t\tif (response.status === 200 && response.data) {\r\n\t\t\t\t\t\t\tresolve(true);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tresolve(false); // case of 403, 404\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch((error) => {\r\n\t\t\t\t\t\tconsole.log('remote cache clear test', error);\r\n\t\t\t\t\t\treject(new Error('no content'));\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tconst checkForNewVersion = async () => {\r\n\t\t// https://stackoverflow.com/questions/45467842/how-to-clear-cache-of-service-worker\r\n\t\t// using the caches.delete() method\r\n\t\t// check if checked within 5 minutes\r\n\t\t// window.localStorage is primarily used here to avoid confusion from\r\n\t\t// treating Dexie(IndexedDB) as localStorage by name\r\n\t\t// also using localStorage because App re-renders and wipes self state\r\n\t\t// I didn't think this needed to be in Dexie\r\n\t\tconst verChecked = window.localStorage.getItem('verChecked');\r\n\t\tif (!verChecked) {\r\n\t\t\twindow.localStorage.setItem('verChecked', Date.now());\r\n\t\t} else if (Date.now() - verChecked > 300000) { // 5 minutes\r\n\t\t\tconst hasRemoteContent = await checkRemoteNotEmpty();\r\n\t\t\tif (!hasRemoteContent || !window.caches) return; // if no remote code, don't pull down or no cache\r\n\t\t\tcaches.keys().then(function(names) {\r\n\t\t\t\tfor (let name of names)\r\n\t\t\t\t\tcaches.delete(name);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tconst updateSoftware = () => {\r\n\t\twindow.localStorage.setItem('verChecked', Date.now() - 360000); // 6 mins in the past\r\n\t\tcheckForNewVersion();\r\n\t\twindow.location.reload();\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tcheckOnlineStatus();\r\n\r\n\t\tif (!offlineStorage) {\r\n\t\t\tsetupOfflineStorage();\r\n\t\t}\r\n\r\n\t\tcheckForNewVersion();\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"tagging-tracker\">\r\n\t\t\t<Router basename={ baseName }>\r\n\t\t\t\t<Route component={ (props) =>\r\n\t\t\t\t\t<Navbar {...props}\r\n\t\t\t\t\t\tbaseDir={ baseName }\r\n\t\t\t\t\t\tsearchAddress={searchAddress}\r\n\t\t\t\t\t\tsearchedAddress={searchedAddress}\r\n\t\t\t\t\t\ttoggleAddressModal={toggleAddressModal}\r\n\t\t\t\t\t\tcheckOnlineStatus={checkOnlineStatus}\r\n\t\t\t\t\t\ttoggleModifyOwnerInfo={toggleModifyOwnerInfo}\r\n\t\t\t\t\t\tmodifyOwnerInfo={modifyOwnerInfo}\r\n\t\t\t\t\t\tmodifyTagInfo={modifyTagInfo}\r\n\t\t\t\t\t\ttoggleModifyTagInfo={toggleModifyTagInfo}\r\n\t\t\t\t\t\tupdateSoftware={updateSoftware} /> } />\r\n\t\t\t\t<div className={ bodyClass }>\r\n\t\t\t\t\t<Switch>\r\n\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\texact\r\n\t\t\t\t\t\t\tpath=\"/login\"\r\n\t\t\t\t\t\t\tcomponent={ (props) =>\r\n\t\t\t\t\t\t\t\ttoken\r\n\t\t\t\t\t\t\t\t\t? <Redirect to=\"/addresses\" />\r\n\t\t\t\t\t\t\t\t\t: <Login {...props} updateToken={updateToken} token={token} />\r\n\t\t\t\t\t\t} />\r\n\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\tpath={\"/view-address\"}\r\n\t\t\t\t\t\t\tcomponent={ (props) =>\r\n\t\t\t\t\t\t\t\ttrue\r\n\t\t\t\t\t\t\t\t? <ViewAddress {...props}\r\n\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage} />\r\n\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> } />\r\n\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\tpath=\"/owner-info\"\r\n\t\t\t\t\t\t\tcomponent={ (props) =>\r\n\t\t\t\t\t\t\t\ttrue\r\n\t\t\t\t\t\t\t\t\t? <OwnerInfo {...props}\r\n\t\t\t\t\t\t\t\t\t\tmodifyOwnerInfo={modifyOwnerInfo}\r\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage} />\r\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> }/>\r\n\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\tpath=\"/tag-info\"\r\n\t\t\t\t\t\t\tcomponent={ (props) =>\r\n\t\t\t\t\t\t\t\ttrue\r\n\t\t\t\t\t\t\t\t\t? <TagInfo {...props}\r\n\t\t\t\t\t\t\t\t\t\tmodifyTagInfo={modifyTagInfo}\r\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage} />\r\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> }/>\r\n\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\tpath=\"/add-tag\"\r\n\t\t\t\t\t\t\tcomponent={ (props) =>\r\n\t\t\t\t\t\t\t\ttrue\r\n\t\t\t\t\t\t\t\t\t? <AddTag\r\n\t\t\t\t\t\t\t\t\t\t{...props}\r\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage}\r\n\t\t\t\t\t\t\t\t\t\tsetBodyClass={setBodyClass}\r\n\t\t\t\t\t\t\t\t\t\ttoken={token}\r\n\t\t\t\t\t\t\t\t\t\tappOnline={appOnline}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> }/>\r\n\t\t\t\t\t\t\t}/>\r\n\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\tpath=\"/edit-tags\"\r\n\t\t\t\t\t\t\tcomponent={ (props) =>\r\n\t\t\t\t\t\t\t\ttrue\r\n\t\t\t\t\t\t\t\t\t? <DeleteTag\r\n\t\t\t\t\t\t\t\t\t\t{...props}\r\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage} />\r\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> }/>\r\n\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\tpath={[\"/\",\"/addresses\"]}\r\n\t\t\t\t\t\t\tcomponent={ (props) =>\r\n\t\t\t\t\t\t\t\ttrue \r\n\t\t\t\t\t\t\t\t\t? <Addresses {...props}\r\n\t\t\t\t\t\t\t\t\t\tsearchedAddress={searchedAddress}\r\n\t\t\t\t\t\t\t\t\t\tsetShowAddressModal={setShowAddressModal}\r\n\t\t\t\t\t\t\t\t\t\tshowAddressModal={showAddressModal}\r\n\t\t\t\t\t\t\t\t\t\ttoggleAddressModal={toggleAddressModal}\r\n\t\t\t\t\t\t\t\t\t\tclearSearchAddress={clearSearchedAddress}\r\n\t\t\t\t\t\t\t\t\t\ttoken={token}\r\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage}\r\n\t\t\t\t\t\t\t\t\t\tgetDateTime={getDateTime} />\r\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> } />\r\n\t\t\t\t\t\t<Route>\r\n\t\t\t\t\t\t\t<Page404 />\r\n\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t</Switch>\r\n\t\t\t\t</div>\r\n\t\t\t\t{/* The explanation here is the AddTag needs to keep its own state so it doesn't\r\n\t\t\t\t\tre-render while adding more images since the initial bridge between bottomNavbar\r\n\t\t\t\t\tand AddTag body was causing the entire app to re-render */}\r\n\t\t\t\t<Route component={ (props) =>\r\n\t\t\t\t\t(props.location.pathname !== \"/login\" && props.location.pathname !== \"/add-tag\")\r\n\t\t\t\t\t\t? <BottomNavbar\r\n\t\t\t\t\t\t\t{...props}\r\n\t\t\t\t\t\t\tbaseDir={ baseName }\r\n\t\t\t\t\t\t\tappOnline={appOnline}\r\n\t\t\t\t\t\t\ttoken={token}\r\n\t\t\t\t\t\t\tsyncApp={syncApp}\r\n\t\t\t\t\t\t\tsetSyncApp={setSyncApp}\r\n\t\t\t\t\t\t\tofflineStorage={offlineStorage}\r\n\t\t\t\t\t\t\tloggingOut={loggingOut}\r\n\t\t\t\t\t\t\tupdateLoggingOut={updateLoggingOut}\r\n\t\t\t\t\t\t\tdeletedAddresses={deletedAddresses}\r\n\t\t\t\t\t\t\tsetDeletedAddresses={setDeletedAddresses}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t: null\r\n\t\t\t\t\t} />\r\n\t\t\t</Router>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' }\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './css-reset.css';\r\nimport './index.scss';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.register();\r\n"],"sourceRoot":""}